"use strict";exports.id=9455,exports.ids=[9455],exports.modules={15656:(a,b,c)=>{c.d(b,{H:()=>m,R0:()=>h,Ro:()=>f,gA:()=>i,gF:()=>k,gQ:()=>j,pU:()=>g,uW:()=>o});let d={quotes:"[admin quotes]",uploads:"[admin uploads]",dashboard:"[admin dashboard]"};function e(a,b,c,e){let f=d[a],g=function(a){if(!a)return null;let b=Object.entries(a).filter(([,a])=>void 0!==a);return 0===b.length?null:Object.fromEntries(b)}(e),h=[`${f} ${c}`,...g&&Object.keys(g).length>0?[g]:[]];return"error"===b?void console.error(...h):"warn"===b?void console.warn(...h):void console.log(...h)}function f(a,b){e("quotes","info",a,b)}function g(a,b){e("quotes","warn",a,b)}function h(a,b){e("quotes","error",a,b)}function i(a,b){e("uploads","info",a,b)}function j(a,b){e("uploads","warn",a,b)}function k(a,b){e("uploads","error",a,b)}function l(a){return a&&"object"==typeof a&&"supabaseError"in a&&a.supabaseError?a.supabaseError:a}function m(a){let b=l(a);return b&&"object"==typeof b?{code:"string"==typeof b.code?b.code:null,message:"string"==typeof b.message?b.message:null,details:"string"==typeof b.details?b.details:null,hint:"string"==typeof b.hint?b.hint:null}:b??null}let n=new Set(["PGRST205","42703"]);function o(a){let b=l(a);if(!b||"object"!=typeof b)return!1;let c="code"in b&&"string"==typeof b.code?b.code:null;return!!c&&n.has(c)}},23696:(a,b,c)=>{c.d(b,{Ef:()=>e}),"true"===process.env.SUPPLIER_ASSIGNMENTS_ENABLED||process.env.NEXT_PUBLIC_SUPPLIER_ASSIGNMENTS_ENABLED;let d="true"===process.env.SUPPLIER_APPROVALS_ENABLED||"true"===process.env.NEXT_PUBLIC_SUPPLIER_APPROVALS_ENABLED;function e(){return d}},23867:(a,b,c)=>{c.d(b,{Ao:()=>f,Hk:()=>e,_A:()=>d});let d="submitted",e=["submitted","in_review","quoted"];function f(a){let b=(a??"").toLowerCase().trim();return"in_review"===b?"in_review":"quoted"===b?"quoted":"won"===b?"won":"lost"===b?"lost":"cancelled"===b||"canceled"===b?"cancelled":"submitted"}},31722:(a,b,c)=>{c.d(b,{G_:()=>u,KF:()=>p,KP:()=>l,WP:()=>i,ZS:()=>o,fd:()=>r,iB:()=>m,jp:()=>k,m9:()=>j,n1:()=>n,rs:()=>q});var d=c(50904);let e="id,company_name,primary_email,user_id,phone,website,country,verified,created_at,notify_quote_messages,notify_quote_winner";function f(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}function h(a){return Array.isArray(a)?a.map(a=>"string"==typeof a?a.trim():"").filter(a=>a.length>0):[]}function i(a){let b=(a?.status??"pending").toLowerCase().trim();return b?"approved"===b?"approved":"rejected"===b?"rejected":"unknown"===b?"unknown":"pending":"pending"}function j(a){return"approved"===i(a)}async function k(a,b,c){let h=f(a);if(!h)throw Error("primaryEmail is required");try{let{data:a,error:f}=await d.w9.from("suppliers").select(e).eq("primary_email",h).maybeSingle();if(f&&console.error("getOrCreateSupplierByEmail: lookup failed",{email:h,error:f}),a){if(!a.user_id&&c){let{error:b}=await d.w9.from("suppliers").update({user_id:c}).eq("id",a.id);b?console.error("getOrCreateSupplierByEmail: failed to link user",{email:h,userId:c,error:b}):a.user_id=c}return a}let i={primary_email:h,company_name:g(b)??h.split("@")[0]?.replace(/\W+/g," ")?.trim()??"Supplier",phone:null,website:null,country:null,verified:!1,user_id:c??null},{data:j,error:k}=await d.w9.from("suppliers").insert(i).select(e).single();if(k||!j)throw console.error("getOrCreateSupplierByEmail: insert failed",{email:h,payload:i,error:k}),Error("Unable to create supplier record");return j}catch(a){throw console.error("getOrCreateSupplierByEmail: unexpected error",{email:h,error:a}),a}}async function l(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierProfile: supplier lookup failed",{email:b,error:c}),null;if(!a)return null;let[f,g]=await Promise.all([s(a.id),t(a.id)]),h=i(a);return{supplier:a,capabilities:f,documents:g,approvalStatus:h,approved:"approved"===h}}catch(a){return console.error("loadSupplierProfile: unexpected error",{email:b,error:a}),null}}async function m(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierByPrimaryEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("loadSupplierByPrimaryEmail: unexpected error",{email:b,error:a}),null}}async function n(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("id",a).maybeSingle();if(c)return console.error("loadSupplierById: lookup failed",{supplierId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierById: unexpected error",{supplierId:a,error:b}),null}}async function o(a){let b=await p(a);if(!b)return null;let[c,d]=await Promise.all([s(b.id),t(b.id)]),e=i(b);return{supplier:b,capabilities:c,documents:d,approvalStatus:e,approved:"approved"===e}}async function p(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("user_id",a).maybeSingle();if(c)return console.error("loadSupplierByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierByUserId: unexpected error",{userId:a,error:b}),null}}async function q(a,b){let c=f(a.primaryEmail);if(!c)throw Error("primaryEmail is required");let h=a.supplierId&&a.supplierId.length>0?await n(a.supplierId):null,j=!h&&a.userId?await p(a.userId):null,l=h??j??await k(c,a.companyName??void 0,a.userId??null),m={company_name:g(a.companyName)??l.company_name,phone:g(a.phone),website:g(a.website),country:g(a.country),primary_email:c,user_id:a.userId??l.user_id};try{let{data:c,error:f}=await d.w9.from("suppliers").update(m).eq("id",l.id).select(e).maybeSingle();if(f)throw console.error("upsertSupplierProfile: supplier update failed",{supplierId:l.id,error:f}),Error("Unable to update supplier record");let g=(a.capabilities??[]).filter(a=>"string"==typeof a?.process&&a.process.trim().length>0);b?.skipCapabilities||await u(l.id,g);let[h,j]=await Promise.all([s(l.id),t(l.id)]),k=c??l,n=i(k);return{supplier:k,capabilities:h,documents:j,approvalStatus:n,approved:"approved"===n}}catch(a){throw console.error("upsertSupplierProfile: unexpected error",{supplierId:l.id,error:a}),a}}async function r(a,b){if(!a)throw Error("supplierId is required");if(!b?.fileUrl)throw Error("fileUrl is required");let c={supplier_id:a,file_url:b.fileUrl,doc_type:g(b.docType)};try{let{data:b,error:e}=await d.w9.from("supplier_documents").insert(c).select("*").single();if(e)throw console.error("addSupplierDocument: insert failed",{supplierId:a,error:e}),e;return b??null}catch(b){throw console.error("addSupplierDocument: unexpected error",{supplierId:a,error:b}),b}}async function s(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").eq("supplier_id",a).order("created_at",{ascending:!0});if(c)return console.error("listSupplierCapabilities: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierCapabilities: unexpected error",{supplierId:a,error:b}),[]}}async function t(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_documents").select("*").eq("supplier_id",a).order("uploaded_at",{ascending:!1});if(c)return console.error("listSupplierDocuments: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierDocuments: unexpected error",{supplierId:a,error:b}),[]}}async function u(a,b){try{let{error:c}=await d.w9.from("supplier_capabilities").delete().eq("supplier_id",a);if(c)throw c;if(0===b.length)return;let e=b.filter(a=>"string"==typeof a.process&&a.process.trim().length>0).map(b=>({supplier_id:a,process:"string"==typeof b.process?b.process.trim():"",materials:h(b.materials),certifications:h(b.certifications),max_part_size:b.maxPartSize??null}));if(0===e.length)return;let{error:f}=await d.w9.from("supplier_capabilities").insert(e);if(f)throw f}catch(b){throw console.error("upsertSupplierCapabilities: unexpected error",{supplierId:a,error:b}),b}}},39455:(a,b,c)=>{c.d(b,{Pl:()=>o,Sy:()=>m,qn:()=>n,wN:()=>p});var d=c(50904),e=c(15656),f=c(31722);c(23696);var g=c(74398);let h="supplier_bids",i="Bids are not available in this environment.",j="We had trouble loading bids.",k="We couldn't select that bid. Please check logs and try again.",l="id,quote_id,supplier_id,unit_price,currency,lead_time_days,notes,status,created_at,updated_at";async function m(a,b){if(!a||!b)return{ok:!1,data:null,error:"Supplier and quote are required."};try{let{data:c,error:f}=await d.w9.from(h).select(l).eq("quote_id",b).eq("supplier_id",a).maybeSingle();if(f){let c=(0,e.H)(f);if((0,e.uW)(f))return console.warn("[bids] detail missing schema",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:i};return console.error("[bids] detail query failed",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:j}}return{ok:!0,data:q(c),error:null}}catch(d){let c=(0,e.H)(d);if((0,e.uW)(d))return console.warn("[bids] detail missing schema",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:i};return console.error("[bids] detail crashed",{supplierId:a,quoteId:b,error:c??d}),{ok:!1,data:null,error:j}}}async function n(a){let b="string"==typeof a?.quoteId?a.quoteId.trim():"",c="string"==typeof a?.bidId?a.bidId.trim():"";if(!b||!c)return console.warn("[bids] winner selection missing identifiers",{quoteId:b,bidId:c}),{ok:!1,error:k};try{let{data:a,error:f}=await d.w9.from(h).select(l).eq("id",c).maybeSingle();if(f){let a=(0,e.H)(f);if((0,e.uW)(f))return console.warn("[bids] winner lookup missing schema",{quoteId:b,bidId:c,error:a}),{ok:!1,error:i};return console.error("[bids] winner lookup failed",{quoteId:b,bidId:c,error:a}),{ok:!1,error:k}}if(!a||a.quote_id!==b)return console.warn("[bids] winner lookup mismatch",{quoteId:b,bidId:c,bidQuoteId:a?.quote_id??null}),{ok:!1,error:k};let j=q(a);if(!j)return console.error("[bids] winner normalize failed",{quoteId:b,bidId:c}),{ok:!1,error:k};let m=new Date().toISOString(),{error:n}=await d.w9.from(h).update({status:"won",updated_at:m}).eq("id",c);if(n){let a=(0,e.H)(n);if((0,e.uW)(n))return console.warn("[bids] winner update missing schema",{quoteId:b,bidId:c,error:a}),{ok:!1,error:i};return console.error("[bids] winner update failed",{quoteId:b,bidId:c,error:a}),{ok:!1,error:k}}let{error:o}=await d.w9.from(h).update({status:"lost",updated_at:m}).eq("quote_id",b).neq("id",c);o&&console.warn("[bids] losing peer bids failed",{quoteId:b,bidId:c,error:(0,e.H)(o)});let p="number"==typeof j.amount&&Number.isFinite(j.amount)?j.amount:null,r="string"==typeof j.currency&&j.currency.trim().length>0?j.currency.trim().toUpperCase():"USD",s=await (0,g.pK)({quoteId:b,status:"won",price:p,currency:r});if(!s.ok)return(0,e.R0)("winner update failed",{quoteId:b,bidId:c,error:s.error}),{ok:!1,error:s.error??g.s3};return(0,e.Ro)("winner update success",{quoteId:b,bidId:c,price:p,currency:r}),console.log("[bids] winner selected",{quoteId:b,bidId:c}),{ok:!0,error:null}}catch(d){let a=(0,e.H)(d);if((0,e.uW)(d))return console.warn("[bids] winner selection missing schema",{quoteId:b,bidId:c,error:a}),{ok:!1,error:i};return console.error("[bids] winner selection crashed",{quoteId:b,bidId:c,error:a??d}),{ok:!1,error:k}}}async function o(a,b){if(!a||!b)throw Error("bidId and quoteId are required");try{let c=await r(a);if(!c||c.quote_id!==b)return console.error("acceptSupplierBidForQuote: mismatched bid/quote",{bidId:a,quoteId:b}),{accepted:null};let e=new Date().toISOString(),{data:g,error:h}=await d.w9.from("supplier_bids").update({status:"accepted",updated_at:e}).eq("id",a).select("*").maybeSingle();if(h||!g)return console.error("acceptSupplierBidForQuote: accept update failed",{bidId:a,quoteId:b,error:h}),{accepted:null};let{error:i}=await d.w9.from("supplier_bids").update({status:"declined",updated_at:e}).eq("quote_id",b).neq("id",a);i&&console.error("acceptSupplierBidForQuote: declining peers failed",{quoteId:b,error:i});let j=await (0,f.n1)(g.supplier_id);return j&&await s(b,j),{accepted:g}}catch(c){throw console.error("acceptSupplierBidForQuote: unexpected error",{bidId:a,quoteId:b,error:c}),c}}async function p(a,b){if(!a)return null;try{let c=await r(a);if(!c)return null;let{data:e,error:f}=await d.w9.from("supplier_bids").update({status:"declined",updated_at:new Date().toISOString()}).eq("id",a).select("*").maybeSingle();if(f)return console.error("declineSupplierBid: update failed",{bidId:a,error:f}),null;return b&&"accepted"===c.status&&await d.w9.from("quotes").update({assigned_supplier_email:null,assigned_supplier_name:null,updated_at:new Date().toISOString()}).eq("id",b),e??null}catch(c){return console.error("declineSupplierBid: unexpected error",{bidId:a,quoteId:b,error:c}),null}}function q(a){return a?{id:a.id,quote_id:a.quote_id,supplier_id:a.supplier_id,amount:function(a){let b="string"==typeof a?Number(a):a;return"number"==typeof b&&Number.isFinite(b)?b:null}(a.unit_price),currency:a.currency??null,lead_time_days:"number"==typeof a.lead_time_days&&Number.isFinite(a.lead_time_days)?a.lead_time_days:null,notes:a.notes??null,status:a.status??null,created_at:a.created_at??null,updated_at:a.updated_at??null}:null}async function r(a){if(!a)return null;let{data:b,error:c}=await d.w9.from("supplier_bids").select("*").eq("id",a).maybeSingle();return c?(console.error("getBidById: lookup failed",{bidId:a,error:c}),null):b??null}async function s(a,b){try{let{error:c}=await d.w9.from("quotes").update({assigned_supplier_email:b.primary_email,assigned_supplier_name:b.company_name,updated_at:new Date().toISOString()}).eq("id",a);c&&console.error("updateQuoteAssignedSupplier: quote update failed",{quoteId:a,supplierId:b.id,error:c})}catch(c){console.error("updateQuoteAssignedSupplier: unexpected error",{quoteId:a,supplierId:b.id,error:c})}}},50904:(a,b,c)=>{c.d(b,{qr:()=>h,w9:()=>i});var d=c(27982);let e=process.env.SUPABASE_URL??"https://qslztdkptpklopyedkfd.supabase.co/",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzbHp0ZGtwdHBrbG9weWVka2ZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTYzMzksImV4cCI6MjA3ODk5MjMzOX0.et6RdF18ioinJKYNNTE0UVA5HvRH1YaXmA2DgRHLPWo",g=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("SUPABASE_URL or NEXT_PUBLIC_SUPABASE_URL is required (check your env vars).");let h=()=>{if(!f)throw Error("NEXT_PUBLIC_SUPABASE_ANON_KEY is required");return(0,d.UU)(e,f,{auth:{persistSession:!1}})},i=(()=>{if(!g)throw Error("SUPABASE_SERVICE_ROLE_KEY is required");return(0,d.UU)(e,g,{auth:{persistSession:!1}})})()},74398:(a,b,c)=>{c.d(b,{pK:()=>i,s3:()=>h});var d=c(50904),e=c(23867),f=c(85150),g=c(15656);[...f.L];let h="Unable to update this quote right now. Please try again.";async function i(a){let b=function(a){let b="string"==typeof a.quoteId?a.quoteId.trim():"";if(!b)return null;let c={};void 0!==a.status&&(c.status=(0,e.Ao)(a.status));let d=function(a){if(void 0!==a){if(null===a)return null;if("number"==typeof a)return Number.isFinite(a)?a:null;if("string"==typeof a){let b=a.trim();if(0===b.length)return null;let c=Number(b);return Number.isFinite(c)?c:null}return null}}(a.price);void 0!==d&&(c.price=d);let f=function(a){let b=k(a);return null==b?b:b.toUpperCase()}(a.currency);void 0!==f&&(c.currency=f);let g=k(a.targetDate);void 0!==g&&(c.target_date=g);let h=k(a.dfmNotes,{preserveCase:!0});void 0!==h&&(c.dfm_notes=h);let i=k(a.internalNotes,{preserveCase:!0});return void 0!==i&&(c.internal_notes=i),{quoteId:b,updates:c}}(a),c=Object.prototype.hasOwnProperty.call(b?.updates??{},"status");if(!b)return(0,g.pU)("update invalid input",{quoteId:a?.quoteId??null}),{ok:!1,error:h};let f=Object.keys(b.updates),i={...b.updates,updated_at:new Date().toISOString()};(0,g.Ro)("update start",{quoteId:b.quoteId,fields:f});try{let{data:a,error:e}=await d.w9.from("quotes").update(i).eq("id",b.quoteId).select("id, upload_id, status").maybeSingle();if(e)return(0,g.uW)(e)?(0,g.pU)("update missing schema",{quoteId:b.quoteId,supabaseError:(0,g.H)(e)}):(0,g.R0)("update failed",{quoteId:b.quoteId,supabaseError:(0,g.H)(e)}),{ok:!1,error:h};if(!a)return(0,g.pU)("update not found",{quoteId:b.quoteId}),{ok:!1,error:h};return(0,g.Ro)("update success",{quoteId:b.quoteId,fields:f}),c&&await j({quoteId:b.quoteId,uploadId:a.upload_id,status:a.status??null}),{ok:!0}}catch(a){return(0,g.R0)("update crashed",{quoteId:b.quoteId,supabaseError:(0,g.H)(a)}),{ok:!1,error:h}}}async function j({quoteId:a,uploadId:b,status:c}){if(!b)return void(0,g.gA)("status sync skipped",{quoteId:a,uploadId:null,status:c});try{let{error:e}=await d.w9.from("uploads").update({status:c}).eq("id",b);if(e){let d={quoteId:a,uploadId:b,status:c,supabaseError:(0,g.H)(e)};(0,g.uW)(e)?(0,g.gQ)("status sync missing schema",d):(0,g.gF)("status sync failed",d);return}(0,g.gA)("status sync success",{quoteId:a,uploadId:b,status:c})}catch(d){(0,g.gF)("status sync crashed",{quoteId:a,uploadId:b,status:c,supabaseError:(0,g.H)(d)})}}function k(a,b){if(void 0===a)return;if(null===a||"string"!=typeof a)return null;let c=a.trim();return 0===c.length?null:(b?.preserveCase,c)}},85150:(a,b,c)=>{c.d(b,{L:()=>d});let d=["id","upload_id","customer_name","email","company","status","price","currency","created_at","updated_at","target_date","file_name"]}};