"use strict";exports.id=9906,exports.ids=[9906],exports.modules={15656:(a,b,c)=>{c.d(b,{H:()=>m,R0:()=>h,Ro:()=>f,gA:()=>i,gF:()=>k,gQ:()=>j,pU:()=>g,uW:()=>o});let d={quotes:"[admin quotes]",uploads:"[admin uploads]",dashboard:"[admin dashboard]"};function e(a,b,c,e){let f=d[a],g=function(a){if(!a)return null;let b=Object.entries(a).filter(([,a])=>void 0!==a);return 0===b.length?null:Object.fromEntries(b)}(e),h=[`${f} ${c}`,...g&&Object.keys(g).length>0?[g]:[]];return"error"===b?void console.error(...h):"warn"===b?void console.warn(...h):void console.log(...h)}function f(a,b){e("quotes","info",a,b)}function g(a,b){e("quotes","warn",a,b)}function h(a,b){e("quotes","error",a,b)}function i(a,b){e("uploads","info",a,b)}function j(a,b){e("uploads","warn",a,b)}function k(a,b){e("uploads","error",a,b)}function l(a){return a&&"object"==typeof a&&"supabaseError"in a&&a.supabaseError?a.supabaseError:a}function m(a){let b=l(a);return b&&"object"==typeof b?{code:"string"==typeof b.code?b.code:null,message:"string"==typeof b.message?b.message:null,details:"string"==typeof b.details?b.details:null,hint:"string"==typeof b.hint?b.hint:null}:b??null}let n=new Set(["PGRST205","42703"]);function o(a){let b=l(a);if(!b||"object"!=typeof b)return!1;let c="code"in b&&"string"==typeof b.code?b.code:null;return!!c&&n.has(c)}},23867:(a,b,c)=>{c.d(b,{Ao:()=>g,Hk:()=>e,RH:()=>h,_A:()=>d});let d="submitted",e=["submitted","in_review","quoted"],f={submitted:"RFQ submitted",in_review:"In review",quoted:"Quote prepared",approved:"Approved",won:"Won",lost:"Lost",cancelled:"Cancelled"};function g(a){let b=(a??"").toLowerCase().trim();return"in_review"===b?"in_review":"quoted"===b?"quoted":"approved"===b?"approved":"won"===b?"won":"lost"===b?"lost":"cancelled"===b||"canceled"===b?"cancelled":"submitted"}function h(a){return f[g(a)]??"Status update"}},26473:(a,b,c)=>{c.d(b,{In:()=>l,TN:()=>j,kZ:()=>h,lG:()=>n,rC:()=>i});var d=c(50904);let e="id,user_id,email,company_name,created_at,notify_quote_messages,notify_quote_winner";function f(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}async function h(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("customers").select(e).eq("user_id",a).maybeSingle();if(c)return console.error("getCustomerByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("getCustomerByUserId: unexpected error",{userId:a,error:b}),null}}async function i(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("customers").select(e).eq("id",a).maybeSingle();if(c)return console.error("getCustomerById: lookup failed",{customerId:a,error:c}),null;return b??null}catch(b){return console.error("getCustomerById: unexpected error",{customerId:a,error:b}),null}}async function j(a){let b=f(a.email);if(!b)return{ok:!1,error:"Your session is missing a valid email address.",details:{reason:"missing-email"}};let c=g(a.companyName)??b.split("@")[0]?.replace(/\W+/g," ").trim()??"Customer",i=g(a.phone),j=g(a.website);try{let f=await h(a.userId),g=await k(b);if(f){let a=await m(f.id,{company_name:c,phone:i,website:j});if(!a)return{ok:!1,error:"We couldn’t update your existing profile record.",details:{reason:"update-existing-user",customerId:f.id}};return{ok:!0,customer:a,operation:"updated_user"}}if(g){let b=await m(g.id,{user_id:a.userId,company_name:c,phone:i,website:j});if(!b)return{ok:!1,error:"We couldn’t link your profile to this account.",details:{reason:"update-existing-email",customerId:g.id}};return{ok:!0,customer:b,operation:"linked_email"}}let n={user_id:a.userId,email:b,company_name:c,phone:i,website:j,updated_at:new Date().toISOString()},{data:o,error:p}=await d.w9.from("customers").insert(n).select(e).single();if(p||!o){var l;if(l=p,l?.code&&"23505"===l.code){let d=await k(b);if(d){let b=await m(d.id,{user_id:a.userId,company_name:c,phone:i,website:j});if(b)return{ok:!0,customer:b,operation:"linked_email"}}}return console.error("upsertCustomerProfileForUser: insert failed",{userId:a.userId,email:b,payload:n,error:p}),{ok:!1,error:"We couldn’t create your customer profile right now.",details:p}}return{ok:!0,customer:o,operation:"inserted"}}catch(c){return console.error("upsertCustomerProfileForUser: unexpected error",{userId:a.userId,email:b,error:c}),{ok:!1,error:"Unexpected error while saving your customer profile.",details:c}}}async function k(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("customers").select(e).ilike("email",b).maybeSingle();if(c)return console.error("getCustomerByEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("getCustomerByEmail: unexpected error",{email:b,error:a}),null}}async function l(a,b){let c=f(b);if(a&&c)try{let{error:b}=await d.w9.from("quotes").update({customer_id:a,updated_at:new Date().toISOString()}).is("customer_id",null).ilike("email",c);b&&console.error("attachQuotesToCustomer: update failed",{customerId:a,email:c,error:b})}catch(b){console.error("attachQuotesToCustomer: unexpected error",{customerId:a,email:c,error:b})}}async function m(a,b){let{data:c,error:f}=await d.w9.from("customers").update({...b,updated_at:new Date().toISOString()}).eq("id",a).select(e).maybeSingle();return f?(console.error("updateCustomer: update failed",{customerId:a,changes:b,error:f}),null):c??null}async function n(a){let b=f(a.email);if(!b)throw Error("A valid email address is required.");let c=g(a.companyName)||b.split("@")[0]?.replace(/\W+/g," ").trim()||"Customer",h={email:b,company_name:c,phone:g(a.phone),updated_at:new Date().toISOString()};try{let{data:a,error:c}=await d.w9.from("customers").upsert(h,{onConflict:"email"}).select(e).single();if(c)return console.error("upsertCustomerByEmail: upsert failed",{email:b,payload:h,error:c}),null;return a??null}catch(a){return console.error("upsertCustomerByEmail: unexpected error",{email:b,error:a}),null}}},31722:(a,b,c)=>{c.d(b,{G_:()=>u,KF:()=>p,KP:()=>l,WP:()=>i,ZS:()=>o,fd:()=>r,iB:()=>m,jp:()=>k,m9:()=>j,n1:()=>n,rs:()=>q});var d=c(50904);let e="id,company_name,primary_email,user_id,phone,website,country,verified,created_at,notify_quote_messages,notify_quote_winner";function f(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}function h(a){return Array.isArray(a)?a.map(a=>"string"==typeof a?a.trim():"").filter(a=>a.length>0):[]}function i(a){let b=(a?.status??"pending").toLowerCase().trim();return b?"approved"===b?"approved":"rejected"===b?"rejected":"unknown"===b?"unknown":"pending":"pending"}function j(a){return"approved"===i(a)}async function k(a,b,c){let h=f(a);if(!h)throw Error("primaryEmail is required");try{let{data:a,error:f}=await d.w9.from("suppliers").select(e).eq("primary_email",h).maybeSingle();if(f&&console.error("getOrCreateSupplierByEmail: lookup failed",{email:h,error:f}),a){if(!a.user_id&&c){let{error:b}=await d.w9.from("suppliers").update({user_id:c}).eq("id",a.id);b?console.error("getOrCreateSupplierByEmail: failed to link user",{email:h,userId:c,error:b}):a.user_id=c}return a}let i={primary_email:h,company_name:g(b)??h.split("@")[0]?.replace(/\W+/g," ")?.trim()??"Supplier",phone:null,website:null,country:null,verified:!1,user_id:c??null},{data:j,error:k}=await d.w9.from("suppliers").insert(i).select(e).single();if(k||!j)throw console.error("getOrCreateSupplierByEmail: insert failed",{email:h,payload:i,error:k}),Error("Unable to create supplier record");return j}catch(a){throw console.error("getOrCreateSupplierByEmail: unexpected error",{email:h,error:a}),a}}async function l(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierProfile: supplier lookup failed",{email:b,error:c}),null;if(!a)return null;let[f,g]=await Promise.all([s(a.id),t(a.id)]),h=i(a);return{supplier:a,capabilities:f,documents:g,approvalStatus:h,approved:"approved"===h}}catch(a){return console.error("loadSupplierProfile: unexpected error",{email:b,error:a}),null}}async function m(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierByPrimaryEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("loadSupplierByPrimaryEmail: unexpected error",{email:b,error:a}),null}}async function n(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("id",a).maybeSingle();if(c)return console.error("loadSupplierById: lookup failed",{supplierId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierById: unexpected error",{supplierId:a,error:b}),null}}async function o(a){let b=await p(a);if(!b)return null;let[c,d]=await Promise.all([s(b.id),t(b.id)]),e=i(b);return{supplier:b,capabilities:c,documents:d,approvalStatus:e,approved:"approved"===e}}async function p(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("user_id",a).maybeSingle();if(c)return console.error("loadSupplierByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierByUserId: unexpected error",{userId:a,error:b}),null}}async function q(a,b){let c=f(a.primaryEmail);if(!c)throw Error("primaryEmail is required");let h=a.supplierId&&a.supplierId.length>0?await n(a.supplierId):null,j=!h&&a.userId?await p(a.userId):null,l=h??j??await k(c,a.companyName??void 0,a.userId??null),m={company_name:g(a.companyName)??l.company_name,phone:g(a.phone),website:g(a.website),country:g(a.country),primary_email:c,user_id:a.userId??l.user_id};try{let{data:c,error:f}=await d.w9.from("suppliers").update(m).eq("id",l.id).select(e).maybeSingle();if(f)throw console.error("upsertSupplierProfile: supplier update failed",{supplierId:l.id,error:f}),Error("Unable to update supplier record");let g=(a.capabilities??[]).filter(a=>"string"==typeof a?.process&&a.process.trim().length>0);b?.skipCapabilities||await u(l.id,g);let[h,j]=await Promise.all([s(l.id),t(l.id)]),k=c??l,n=i(k);return{supplier:k,capabilities:h,documents:j,approvalStatus:n,approved:"approved"===n}}catch(a){throw console.error("upsertSupplierProfile: unexpected error",{supplierId:l.id,error:a}),a}}async function r(a,b){if(!a)throw Error("supplierId is required");if(!b?.fileUrl)throw Error("fileUrl is required");let c={supplier_id:a,file_url:b.fileUrl,doc_type:g(b.docType)};try{let{data:b,error:e}=await d.w9.from("supplier_documents").insert(c).select("*").single();if(e)throw console.error("addSupplierDocument: insert failed",{supplierId:a,error:e}),e;return b??null}catch(b){throw console.error("addSupplierDocument: unexpected error",{supplierId:a,error:b}),b}}async function s(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").eq("supplier_id",a).order("created_at",{ascending:!0});if(c)return console.error("listSupplierCapabilities: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierCapabilities: unexpected error",{supplierId:a,error:b}),[]}}async function t(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_documents").select("*").eq("supplier_id",a).order("uploaded_at",{ascending:!1});if(c)return console.error("listSupplierDocuments: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierDocuments: unexpected error",{supplierId:a,error:b}),[]}}async function u(a,b){try{let{error:c}=await d.w9.from("supplier_capabilities").delete().eq("supplier_id",a);if(c)throw c;if(0===b.length)return;let e=b.filter(a=>"string"==typeof a.process&&a.process.trim().length>0).map(b=>({supplier_id:a,process:"string"==typeof b.process?b.process.trim():"",materials:h(b.materials),certifications:h(b.certifications),max_part_size:b.maxPartSize??null}));if(0===e.length)return;let{error:f}=await d.w9.from("supplier_capabilities").insert(e);if(f)throw f}catch(b){throw console.error("upsertSupplierCapabilities: unexpected error",{supplierId:a,error:b}),b}}},50904:(a,b,c)=>{c.d(b,{qr:()=>h,w9:()=>i});var d=c(27982);let e=process.env.SUPABASE_URL??"https://qslztdkptpklopyedkfd.supabase.co/",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzbHp0ZGtwdHBrbG9weWVka2ZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTYzMzksImV4cCI6MjA3ODk5MjMzOX0.et6RdF18ioinJKYNNTE0UVA5HvRH1YaXmA2DgRHLPWo",g=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("SUPABASE_URL or NEXT_PUBLIC_SUPABASE_URL is required (check your env vars).");let h=()=>{if(!f)throw Error("NEXT_PUBLIC_SUPABASE_ANON_KEY is required");return(0,d.UU)(e,f,{auth:{persistSession:!1}})},i=(()=>{if(!g)throw Error("SUPABASE_SERVICE_ROLE_KEY is required");return(0,d.UU)(e,g,{auth:{persistSession:!1}})})()},51739:(a,b,c)=>{function d(a,b,c){if("number"!=typeof a||Number.isNaN(a))return"—";let d=(b??"USD").toUpperCase(),e=c?.maximumFractionDigits??0,f=c?.minimumFractionDigits??e;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:d,minimumFractionDigits:f,maximumFractionDigits:e}).format(a)}catch{let b=Math.max(f,e);return`${d} ${a.toFixed(b)}`}}c.d(b,{CT:()=>z,VJ:()=>y,vT:()=>x,cE:()=>r,X1:()=>A,Vv:()=>s});var e=c(50904);let f=process.env.RESEND_API_KEY,g=process.env.NOTIFICATIONS_FROM_EMAIL??"Zartman <notifications@zartman.io>";async function h(a){var b;if(!a?.to)return void console.warn("[notifications] missing recipient email",{subject:a?.subject??null});if(!f)return void console.warn("[notifications] RESEND_API_KEY not configured; email skipped",{to:a.to,subject:a.subject});let c={from:g,to:a.to,subject:a.subject,html:a.previewText?`${b=a.previewText,`<div style="display:none;font-size:1px;color:#fefefe;line-height:1px;max-height:0px;max-width:0px;opacity:0;overflow:hidden;">${b}</div>`}${a.html}`:a.html};try{let b=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!b.ok){let c=await i(b);console.error("[notifications] email send failed",{to:a.to,subject:a.subject,status:b.status,error:c})}}catch(b){console.error("[notifications] email send crashed",{to:a.to,subject:a.subject,error:b instanceof Error?{message:b.message,stack:b.stack}:String(b)})}}async function i(a){try{return await a.json()}catch{return{statusText:a.statusText}}}async function j(a,b){let c=l(a);console.log("[notifications] dispatch start",c);try{return await b(),console.log("[notifications] dispatch success",c),!0}catch(a){var d;return console.error("[notifications] dispatch failed",{...c,error:(d=a)instanceof Error?{name:d.name,message:d.message,stack:d.stack}:d&&"object"==typeof d?{...d}:d??null}),!1}}async function k(a){let{subject:b,previewText:c,html:d,skipIfMissingRecipient:e=!0,...f}=a,g=f.recipientEmail??null,i=l({...f,recipientEmail:g});return!g&&e?(console.warn("[notifications] dispatch skipped",{...i,reason:"missing-recipient"}),!1):j({...f,recipientEmail:g,channel:f.channel??"email"},()=>h({to:g??"",subject:b,previewText:c,html:d}))}function l(a){return{eventType:a.eventType,quoteId:a.quoteId??null,recipientEmail:a.recipientEmail??null,audience:a.audience??null,channel:a.channel??null,payload:a.payload??null}}function m(a,b){if(!a)return!0;switch(b){case"quote_message_customer":return a.notify_quote_messages??!0;case"winner_customer":return a.notify_quote_winner??!0;default:return!0}}function n(a,b){if(!a)return!0;switch(b){case"quote_message_supplier":return a.notify_quote_messages??!0;case"winner_supplier":return a.notify_quote_winner??!0;default:return!0}}var o=c(52453),p=c(23867);let q=process.env.NOTIFICATIONS_ADMIN_EMAIL??"admin@zartman.io";async function r(a){var b,c;let d=await (0,o.LC)(a.quote_id);if(!d)return void console.warn("[quote notifications] message skipped",{quoteId:a.quote_id,authorType:a.author_type,reason:"missing-quote-context"});let{quote:e,customer:f}=d,g=(b=a.author_type,c=e,"customer"===b?{email:q,label:"Zartman admin",type:"admin"}:"admin"===b||"supplier"===b?c.email?{email:c.email,label:c.customer_name??c.company??"Customer",type:"customer"}:null:null);return g?"customer"!==g.type||m(f,"quote_message_customer")?"supplier"!==g.type||n(g.supplier??null,"quote_message_supplier")?void await k({eventType:"quote_message_posted",quoteId:e.id,recipientEmail:g.email,audience:"customer"===g.type?"customer":"supplier"===g.type?"supplier":"admin",payload:{authorType:a.author_type,recipientType:g.type,messageId:a.id},subject:`New message on RFQ ${u(e)}`,previewText:`${g.label} received a new message on quote ${e.id}`,html:function(a,b,c){let d=v("customer"===a.author_type?`/admin/quotes/${b.id}`:`/customer/quotes/${b.id}`);return`
    <p>${c},</p>
    <p><strong>${a.author_name??"A teammate"}</strong> posted a new message on <strong>${u(b)}</strong>.</p>
    <blockquote style="border-left:4px solid #94a3b8;padding:0.5rem 1rem;color:#0f172a;">${a.body}</blockquote>
    <p><a href="${d}">Open the workspace</a> to reply.</p>
  `}(a,e,g.label)}):void console.log("[quote notifications] message skipped due to preferences",{quoteId:e.id,recipientType:"supplier",supplierId:g.supplier?.id??null}):void console.log("[quote notifications] message skipped due to preferences",{quoteId:e.id,recipientType:"customer"}):void console.log("[quote notifications] message skipped",{quoteId:e.id,authorType:a.author_type,reason:"recipient-unavailable"})}async function s(a){let b=a.supplier.primary_email??null,c=a.customer?.email??a.quote.email??null,e=u(a.quote),f=v(`/supplier/quotes/${a.quote.id}`),g=v(`/customer/quotes/${a.quote.id}`),h=d(function(a){if("number"==typeof a)return a;if("string"==typeof a){let b=Number(a);return Number.isNaN(b)?null:b}return null}(a.winningBid.unit_price),a.winningBid.currency??a.quote.currency??"USD"),i="number"==typeof a.winningBid.lead_time_days?`${a.winningBid.lead_time_days} day${1===a.winningBid.lead_time_days?"":"s"}`:"Lead time not provided",j=[],l=!1,o=!1;n(a.supplier,"winner_supplier")?b&&(j.push(k({eventType:"bid_won",quoteId:a.quote.id,recipientEmail:b,audience:"supplier",payload:{bidId:a.winningBid.id,supplierId:a.supplier.id},subject:`Your bid won – RFQ ${e}`,previewText:`We selected your proposal for ${e}.`,html:`
            <p>Congrats! Your bid for <strong>${e}</strong> was selected as the winner.</p>
            <p><strong>Price:</strong> ${h}<br/>
            <strong>Lead time:</strong> ${i}</p>
            <p><a href="${f}">Open the supplier workspace</a> to review next steps.</p>
          `})),l=!0):console.log("[quote notifications] winner email skipped (supplier prefs)",{quoteId:a.quote.id,bidId:a.winningBid.id,supplierId:a.supplier.id}),m(a.customer,"winner_customer")?c&&(j.push(k({eventType:"quote_won",quoteId:a.quote.id,recipientEmail:c,audience:"customer",payload:{bidId:a.winningBid.id,supplierId:a.supplier.id},subject:"Winning supplier selected for your RFQ",previewText:`We marked a winning supplier for ${e}.`,html:`
            <p>You selected <strong>${a.supplier.company_name??"a supplier"}</strong> for <strong>${e}</strong>.</p>
            <p><strong>Winning bid:</strong> ${h} (${i})</p>
            <p><a href="${g}">View the quote workspace</a> to keep the project moving.</p>
          `})),o=!0):console.log("[quote notifications] winner email skipped (customer prefs)",{quoteId:a.quote.id,bidId:a.winningBid.id,customerId:a.customer?.id??null}),0===j.length?console.log("[quote notifications] winning bid emails skipped",{quoteId:a.quote.id,bidId:a.winningBid.id,supplierId:a.supplier.id,reason:"no-allowed-recipients"}):(await Promise.allSettled(j),console.log("[quote notifications] winning bid notifications dispatched",{quoteId:a.quote.id,bidId:a.winningBid.id,supplierId:a.supplier.id,supplierNotified:l,customerNotified:o})),await t({quote:a.quote,winningBidId:a.winningBid.id,winningSupplierName:a.supplier.company_name??a.supplier.primary_email??"another supplier"})}async function t(a){try{let{data:b,error:c}=await e.w9.from("supplier_bids").select("id,supplier_id,status,unit_price,currency,lead_time_days,updated_at").eq("quote_id",a.quote.id).neq("id",a.winningBidId);if(c)return void console.error("[quote notifications] losing supplier lookup failed",{quoteId:a.quote.id,error:c});let d=(b??[]).filter(a=>"lost"===(a.status??"").toLowerCase());if(0===d.length)return;let f=Array.from(new Set(d.map(a=>a.supplier_id).filter(a=>!!a)));if(0===f.length)return;let{data:g,error:h}=await e.w9.from("suppliers").select("id,company_name,primary_email").in("id",f);if(h)return void console.error("[quote notifications] losing supplier context failed",{quoteId:a.quote.id,error:h});let i=new Map((g??[]).map(a=>[a.id,a])),j=u(a.quote);await Promise.all(d.map(b=>{let c=b.supplier_id?i.get(b.supplier_id):null,d=c?.primary_email??null;return d?k({eventType:"bid_lost",quoteId:a.quote.id,recipientEmail:d,audience:"supplier",payload:{bidId:b.id,supplierId:b.supplier_id},subject:`RFQ ${j} closed`,previewText:`We selected another supplier for ${j}.`,html:function(a){let b=v(`/supplier/quotes/${a.quoteId}`);return`
    <p>Thanks for submitting a proposal for <strong>${a.quoteTitle}</strong>.</p>
    <p>We selected ${a.winningSupplierName??"another supplier"} for this project. We'll keep you posted when future RFQs are a fit.</p>
    <p><a href="${b}">Open the supplier workspace</a> to review the RFQ details.</p>
  `}({quoteTitle:j,winningSupplierName:a.winningSupplierName,quoteId:a.quote.id})}):(console.warn("[quote notifications] losing supplier missing email",{quoteId:a.quote.id,bidId:b.id,supplierId:b.supplier_id}),Promise.resolve(!1))}))}catch(b){console.error("[quote notifications] losing supplier notify failed",{quoteId:a.quote.id,error:b})}}function u(a){return a.file_name??a.company??`Quote ${a.id.slice(0,6)}`}function v(a){return`https://zartman.io${a}`}let w={quoted:{eventType:"quote_quoted",subject:a=>`Quote ready for ${a}`,previewText:"Review pricing and DFM notes.",body:({quoteTitle:a,quoteId:b,statusLabel:c})=>{let d=v(`/customer/quotes/${b}`);return`
        <p>We updated <strong>${a}</strong> to <strong>${c}</strong>.</p>
        <p><a href="${d}">Open your workspace</a> to review the quote package.</p>
      `}},approved:{eventType:"quote_approved",subject:a=>`${a} approved for kickoff`,previewText:"We signed off on your RFQ.",body:({quoteTitle:a,quoteId:b,statusLabel:c})=>{let d=v(`/customer/quotes/${b}`);return`
        <p>${a} is now <strong>${c}</strong>. We're lining up the next steps.</p>
        <p><a href="${d}">View the RFQ</a> to share kickoff details.</p>
      `}},won:{eventType:"quote_won",subject:a=>`${a} marked as won`,previewText:"We selected a supplier for this RFQ.",body:({quoteTitle:a,quoteId:b,statusLabel:c})=>{let d=v(`/customer/quotes/${b}`);return`
        <p>${a} is <strong>${c}</strong>. We captured the winning proposal in your workspace.</p>
        <p><a href="${d}">Open the workspace</a> to coordinate kickoff.</p>
      `}}};async function x(a){let b=w[a.status];if(!b)return;let c=a.context??await (0,o.LC)(a.quoteId);if(!c?.quote?.email)return void console.warn("[quote notifications] status email skipped",{quoteId:a.quoteId,status:a.status,reason:"missing-recipient"});let d=u(c.quote),e=(0,p.RH)(a.status);await k({eventType:b.eventType,quoteId:a.quoteId,recipientEmail:c.quote.email,audience:"customer",payload:{status:a.status},subject:b.subject(d),previewText:b.previewText,html:b.body({quoteTitle:d,quoteId:a.quoteId,statusLabel:e})})}async function y(a){await k({eventType:"quote_submitted",quoteId:a.quoteId,recipientEmail:q,audience:"admin",payload:{contactEmail:a.contactEmail,company:a.company??null},subject:`New RFQ submitted by ${a.contactName||a.contactEmail}`,previewText:`${a.contactEmail} uploaded ${a.fileName??"an RFQ"}.`,html:function(a){let b=v(`/admin/quotes/${a.quoteId}`),c=D(a.company)??"Not provided",d=D(a.contactName)??a.contactEmail,e=D(a.fileName)??"Untitled RFQ";return`
    <p><strong>${d}</strong> just submitted a new RFQ.</p>
    <p>Email: ${a.contactEmail}<br/>
    Company: ${c}<br/>
    File: ${e}</p>
    <p><a href="${b}">Review in the admin workspace</a></p>
  `}(a)})}async function z(a){await k({eventType:"bid_submitted",quoteId:a.quoteId,recipientEmail:q,audience:"admin",payload:{bidId:a.bidId,supplierId:a.supplierId},subject:`New bid from ${a.supplierName??"a supplier"} on ${a.quoteTitle}`,previewText:`${a.quoteTitle} just received a bid.`,html:function(a){let b="number"==typeof a.amount?d(a.amount,a.currency??"USD"):"Pricing pending",c="number"==typeof a.leadTimeDays&&Number.isFinite(a.leadTimeDays)?`${a.leadTimeDays} day${1===a.leadTimeDays?"":"s"}`:"Lead time pending",e=v(`/admin/quotes/${a.quoteId}`),f=D(a.supplierName)??"Supplier partner",g=D(a.supplierEmail)??"Not provided";return`
    <p><strong>${f}</strong> submitted a bid on <strong>${a.quoteTitle}</strong>.</p>
    <p>${b} • ${c}<br/>Email: ${g}</p>
    <p><a href="${e}">Review the bid</a></p>
  `}(a)})}async function A(a){try{let b=await C(a.quoteId);if(!b)return void console.warn("[quote notifications] project kickoff skipped",{quoteId:a.quoteId,reason:"missing-quote-context"});let c=u(b),d=function(a){let b=[],c=D(a.po_number);c&&b.push(`<li><strong>PO #</strong>: ${c}</li>`);let d=D(a.target_ship_date);d&&b.push(`<li><strong>Target ship date</strong>: ${d}</li>`);let e=function(a){let b=D(a);return b?b.replace(/\r?\n/g,"<br/>"):null}(a.notes);return(e&&b.push(`<li><strong>Notes</strong>: ${e}</li>`),0===b.length)?"<p>No kickoff details were provided.</p>":`<ul>${b.join("")}</ul>`}(a.project),e=a.created?"project_kickoff_created":"project_kickoff_updated",f=a.project.po_number??a.project.target_ship_date??(a.created?"Kickoff created":"Kickoff updated"),g={projectId:a.project.id,created:a.created},h=[];b.email&&h.push(k({eventType:e,quoteId:a.quoteId,recipientEmail:b.email,audience:"customer",payload:g,subject:`${a.created?"Project kickoff captured":"Project kickoff updated"} for ${c}`,previewText:f,html:B({audience:"customer",quoteTitle:c,summaryHtml:d,link:v(`/customer/quotes/${a.quoteId}`),created:a.created})})),b.assigned_supplier_email&&h.push(k({eventType:e,quoteId:a.quoteId,recipientEmail:b.assigned_supplier_email,audience:"supplier",payload:g,subject:`Kickoff details for ${c}`,previewText:f,html:B({audience:"supplier",quoteTitle:c,summaryHtml:d,link:v(`/supplier/quotes/${a.quoteId}`),created:a.created})})),h.push(k({eventType:e,quoteId:a.quoteId,recipientEmail:q,audience:"admin",payload:g,subject:`[Admin] ${a.created?"Project kickoff created":"Project kickoff updated"} (${c})`,previewText:f,html:B({audience:"admin",quoteTitle:c,summaryHtml:d,link:v(`/admin/quotes/${a.quoteId}`),created:a.created})})),await Promise.allSettled(h)}catch(b){console.error("[quote notifications] project kickoff notify failed",{quoteId:a.quoteId,error:b})}}function B(a){let b="supplier"===a.audience?`The customer shared kickoff details for <strong>${a.quoteTitle}</strong>.`:"customer"===a.audience?`We ${a.created?"captured":"updated"} kickoff info for <strong>${a.quoteTitle}</strong>.`:`Kickoff info for <strong>${a.quoteTitle}</strong> was ${a.created?"created":"updated"}.`;return`
    <p>${b}</p>
    ${a.summaryHtml}
    <p><a href="${a.link}">Open the workspace</a> to review.</p>
  `}async function C(a){if(!a)return null;try{let{data:b,error:c}=await e.w9.from("quotes_with_uploads").select("id,file_name,company,customer_name,email,customer_id,assigned_supplier_email,assigned_supplier_name").eq("id",a).maybeSingle();if(c)return console.error("[quote notifications] project quote lookup failed",{quoteId:a,error:c}),null;return b??null}catch(b){return console.error("[quote notifications] project quote lookup crashed",{quoteId:a,error:b}),null}}function D(a){if("string"!=typeof a)return null;let b=a.trim();return b?b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):null}},52453:(a,b,c)=>{c.d(b,{LC:()=>g,ie:()=>i});var d=c(50904),e=c(26473),f=c(31722);async function g(a){let b=await j(a);if(!b)return null;let{status:c,price:d,currency:f,...g}=b,h=g.customer_id&&g.customer_id.length>0?await (0,e.rC)(g.customer_id):null;return{quote:g,customer:h}}async function h(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("supplier_bids").select("*").eq("id",a).maybeSingle();if(c)return console.error("[quote notifications] bid lookup failed",{bidId:a,error:c}),null;return b??null}catch(b){return console.error("[quote notifications] bid lookup crashed",{bidId:a,error:b}),null}}async function i(a){let b=await h(a);if(!b)return console.warn("[quote notifications] winner context missing bid",{bidId:a}),null;if(!b.supplier_id)return console.warn("[quote notifications] winner context missing supplier id",{bidId:a,quoteId:b.quote_id}),null;let c=await (0,f.n1)(b.supplier_id);return c?{winningBid:b,supplier:c}:(console.warn("[quote notifications] winner context missing supplier record",{bidId:a,supplierId:b.supplier_id}),null)}async function j(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("quotes_with_uploads").select("id,file_name,company,customer_name,email,customer_id,status,price,currency").eq("id",a).maybeSingle();if(c)return console.error("[quote notifications] quote lookup failed",{quoteId:a,error:c}),null;return b??null}catch(b){return console.error("[quote notifications] quote lookup crashed",{quoteId:a,error:b}),null}}}};