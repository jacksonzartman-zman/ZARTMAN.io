exports.id=5609,exports.ids=[5609],exports.modules={9736:(a,b,c)=>{"use strict";c.d(b,{x:()=>n,A:()=>m});var d=c(75338),e=c(75879);c(68633);var f=c(72224),g=c(76522),h=c(82161),i=c(67285),j=c(84472),k=c(50521);async function l(a){let b=a.limit??12;if(!a.userId&&!a.email)return[];let[c,d]=await Promise.all([a.userId?(0,j.kZ)(a.userId):Promise.resolve(null),a.email?(0,k.KP)(a.email):Promise.resolve(null)]),e=c?(0,i.Y)({customerId:c.id,email:c.email??a.email??null,domain:function(a){if(!a||!a.includes("@"))return null;let[,b]=a.split("@");return b?.toLowerCase()??null}(c.email??a.email??null),limit:b}):Promise.resolve([]),f=d?.supplier?(0,i.E)({supplierId:d.supplier.id,supplierEmail:d.supplier.primary_email??a.email??null,limit:b}):Promise.resolve({ok:!0,data:[]}),[g,h]=await Promise.all([e,f]),l=h.ok?h.data:[];return[...g.map(a=>({...a,source:"customer",read:!1})),...l.map(a=>({...a,source:"supplier",read:!1}))].sort((a,b)=>{let c=Date.parse(a.timestamp)||0;return(Date.parse(b.timestamp)||0)-c}).slice(0,b)}async function m(){let a=await (0,g.qQ)(),b=a?await l({userId:a.user.id,email:a.user.email??null}):[],c=a?{email:a.user.email??null,displayName:a.user.user_metadata?.company??a.user.user_metadata?.full_name??a.user.email??null}:null;return(0,d.jsx)(f.default,{user:c,signOutAction:a?o:void 0,notifications:b})}let n=async function(){let a=(0,g.MB)();try{await a.auth.signOut()}catch(a){console.error("AppHeader: sign out failed",a)}(0,h.redirect)("/")};(0,e.A)(n,"0021070385a5d7dd049fc53c03029546750b347379",null);var o=n},31143:(a,b,c)=>{"use strict";c.d(b,{A:()=>f});var d=c(75338),e=c(9736);function f({children:a}){return(0,d.jsxs)("div",{className:"min-h-screen bg-slate-950 text-slate-50",children:[(0,d.jsx)(e.A,{}),(0,d.jsx)("main",{className:"mx-auto w-full max-w-6xl px-4 py-10 sm:px-6 lg:px-8",children:a})]})}},57848:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"0021070385a5d7dd049fc53c03029546750b347379":()=>d.x});var d=c(9736)},64600:(a,b,c)=>{"use strict";c.d(b,{default:()=>o});var d=c(21124),e=c(38301),f=c(3991),g=c.n(f),h=c(42378),i=c(43249),j=c(32999),k=c(36905);let l={customer:"Customer workspace",supplier:"Supplier workspace"},m={customer:"border-emerald-400/40 text-emerald-200 bg-emerald-500/5",supplier:"border-blue-400/40 text-blue-200 bg-blue-500/5"},n={customer:[{label:"Dashboard",href:"/customer"},{label:"Quotes",href:"/customer/quotes"},{label:"Settings",href:"/customer/settings"}],supplier:[{label:"Dashboard",href:"/supplier"},{label:"RFQs",href:"/supplier/rfqs"},{label:"Settings",href:"/supplier/settings"}]};function o({user:a,notifications:b=[],signOutAction:c}){let f=(0,h.usePathname)()??"/",o=(0,e.useMemo)(()=>{var a;return(a=f).startsWith("/customer")?"customer":a.startsWith("/supplier")?"supplier":null},[f]),q=o?n[o]:[];return(0,d.jsx)("header",{className:"sticky top-0 z-40 border-b border-slate-900/70 bg-neutral-950/95 backdrop-blur",children:(0,d.jsxs)("div",{className:"mx-auto flex w-full max-w-page flex-col gap-3 px-4 py-4 sm:px-6 lg:px-8",children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,d.jsx)(k.R,{withWordmark:!0,subLabel:"Workspace",size:32,className:"text-base font-semibold text-ink transition-colors hover:text-ink-soft"}),a&&o?(0,d.jsx)("span",{className:(0,i.A)("inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold uppercase tracking-wide",m[o]),children:l[o]}):null]}),(0,d.jsx)("div",{className:"flex items-center gap-3",children:a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(p,{notifications:b}),(0,d.jsx)(s,{user:a,role:o,signOutAction:c})]}):(0,d.jsxs)("div",{className:"flex items-center gap-3 text-sm font-semibold text-ink-soft",children:[(0,d.jsx)(g(),{href:"/login",className:"rounded-full border border-transparent px-4 py-1.5 transition-colors hover:border-slate-800 hover:text-ink",children:"Log in"}),(0,d.jsx)(g(),{href:"/quote",className:j.n4,children:"Get quote"})]})})]}),a&&q.length>0?(0,d.jsx)("nav",{className:"flex flex-wrap items-center gap-2 text-sm font-medium text-slate-400",children:q.map(a=>{var b,c;let e=(b=f)===(c=a.href)||b.startsWith(`${c}/`);return(0,d.jsx)(g(),{href:a.href,className:(0,i.A)("rounded-full px-3 py-1.5 transition-colors",e?"bg-slate-900 text-white":"text-slate-400 hover:text-white"),children:a.label},a.href)})}):null]})})}function p({notifications:a}){let[b,c]=(0,e.useState)(!1),f=(0,e.useRef)(null);(0,h.usePathname)();let g=a.length>0,i=a.filter(a=>!1===a.read).length;return(0,d.jsxs)("div",{className:"relative",ref:f,children:[(0,d.jsxs)("button",{type:"button",onClick:()=>c(a=>!a),className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-900/70 bg-slate-950/70 text-slate-300 transition hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-blue-300","aria-haspopup":"menu","aria-expanded":b,"aria-label":g?"View notifications":"No notifications",children:[(0,d.jsx)(r,{className:"h-5 w-5"}),i>0?(0,d.jsx)("span",{className:"absolute -right-0.5 -top-0.5 inline-flex h-2.5 w-2.5 rounded-full bg-sky-400/90 ring-2 ring-slate-950",children:(0,d.jsx)("span",{className:"sr-only",children:`${i} unread notification${1===i?"":"s"}`})}):null]}),b?(0,d.jsxs)("div",{className:"absolute right-0 mt-2 w-80 rounded-2xl border border-slate-900/80 bg-slate-950/95 p-4 text-sm text-slate-200 shadow-[0_18px_40px_rgba(2,6,23,0.65)]",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,d.jsx)("p",{className:"text-sm font-semibold text-white",children:"Notifications"}),(0,d.jsx)("span",{className:"text-xs text-slate-500",children:g?`${i||a.length} new`:"All caught up"})]}),(0,d.jsx)("div",{className:"mt-3 space-y-2",children:g?a.map(a=>(0,d.jsx)(q,{notification:a},a.id)):(0,d.jsx)("p",{className:"text-xs text-slate-500",children:"We’ll surface quote and bid updates here soon."})})]}):null]})}function q({notification:a}){let b=function(a){if("number"!=typeof a||Number.isNaN(a))return null;let b=Date.now()-a;if(b<6e4)return"just now";if(b<36e5){let a=Math.max(1,Math.round(b/6e4));return`${a} minute${1===a?"":"s"} ago`}if(b<864e5){let a=Math.round(b/36e5);return`${a} hour${1===a?"":"s"} ago`}let c=Math.round(b/864e5);return`${c} day${1===c?"":"s"} ago`}(function(a){if(!a)return null;let b=Date.parse(a);return Number.isNaN(b)?null:b}(a.timestamp))??"Just now",c="bid"===a.type?"Bid":"status"===a.type?"Status":"Quote",e=(0,d.jsxs)("div",{className:(0,i.A)("flex flex-col rounded-2xl border px-3 py-2 transition hover:border-blue-400/30 hover:bg-slate-900/40",a.read?"border-slate-900/70 opacity-80":"border-blue-500/30"),children:[(0,d.jsx)("span",{className:(0,i.A)("mb-2 inline-flex w-fit items-center rounded-full border px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide",{Quote:"bg-emerald-500/10 text-emerald-200 border-emerald-500/30",Bid:"bg-blue-500/10 text-blue-200 border-blue-500/30",Status:"bg-slate-500/10 text-slate-200 border-slate-500/30"}[c]??""),children:c}),(0,d.jsx)("p",{className:"text-sm font-semibold text-white",children:a.title}),(0,d.jsx)("p",{className:"text-xs text-slate-400",children:a.description}),(0,d.jsx)("p",{className:"mt-2 text-[11px] uppercase tracking-wide text-slate-500",children:b})]});return a.href?(0,d.jsx)(g(),{href:a.href,className:"block focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-300",onClick:a=>a.stopPropagation(),children:e}):e}function r({className:a}){return(0,d.jsxs)("svg",{className:a,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[(0,d.jsx)("path",{d:"M12 4a4 4 0 0 0-4 4v2.26c0 .46-.18.9-.5 1.22L6.2 12.78A1 1 0 0 0 6.9 14h10.2a1 1 0 0 0 .7-1.72l-1.3-1.3a1.73 1.73 0 0 1-.5-1.22V8a4 4 0 0 0-4-4Z"}),(0,d.jsx)("path",{d:"M10 17a2 2 0 0 0 4 0"})]})}function s({user:a,role:b,signOutAction:c}){let[f,j]=(0,e.useState)(!1),k=(0,e.useRef)(null);(0,h.usePathname)();let l=a.displayName??a.email??"Signed in user";return(0,d.jsxs)("div",{className:"relative",ref:k,children:[(0,d.jsxs)("button",{type:"button",onClick:()=>j(a=>!a),className:"inline-flex items-center gap-2 rounded-full border border-slate-800 bg-slate-950/50 px-4 py-1.5 text-sm font-semibold text-slate-200 transition hover:border-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-300","aria-haspopup":"menu","aria-expanded":f,children:[(0,d.jsx)("span",{children:function(a,b=28){return a.length<=b?a:`${a.slice(0,b-3)}...`}(l)}),(0,d.jsx)("svg",{className:(0,i.A)("h-4 w-4 transition-transform",f?"rotate-180":"rotate-0"),viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:(0,d.jsx)("path",{d:"M5 7l5 5 5-5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]}),f?(0,d.jsxs)("div",{className:"absolute right-0 mt-2 w-64 rounded-2xl border border-slate-900 bg-slate-950/95 p-4 text-sm shadow-lg shadow-black/40",children:[(0,d.jsx)("p",{className:"text-xs text-slate-500",children:"Signed in as"}),(0,d.jsx)("p",{className:"mt-1 font-semibold text-white",children:a.displayName??"Workspace user"}),a.email?(0,d.jsx)("p",{className:"text-xs text-slate-500",children:a.email}):null,(0,d.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,d.jsx)(g(),{href:"customer"===b?"/customer/settings":"supplier"===b?"/supplier/settings":"/account/settings",className:"rounded-full border border-slate-800 px-3 py-1.5 text-left text-sm font-semibold text-slate-100 transition hover:border-slate-700 hover:text-white",onClick:()=>j(!1),children:"Account settings"}),(0,d.jsx)("form",{action:c,children:(0,d.jsx)("button",{type:"submit",className:"w-full rounded-full bg-red-500/10 px-3 py-1.5 text-sm font-semibold text-red-200 transition hover:bg-red-500/20",children:"Log out"})})]})]}):null]})}},67285:(a,b,c)=>{"use strict";c.d(b,{E:()=>p,Y:()=>o});var d=c(64811),e=c(12831),f=c(2254),g=c(28503),h=c(25049),i=c(49669),j=c(33358),k=c(84472);let l="supplier activity",m=h.L,n={submitted:"RFQ submitted",in_review:"RFQ under review",quoted:"Quote prepared",won:"Quote won",lost:"Quote closed as lost",cancelled:"RFQ cancelled"};async function o(a){let b=a.limit??10,c=await q({customerId:a.customerId??null,email:a.email??null,domain:a.domain??null,limit:Math.max(2*b,20)});if(0===c.length)return[];let d=c.map(a=>a.id),e=await y({quoteIds:d},3*b,!0),f=E([...c.map(a=>B(a,"customer")),...c.map(a=>C(a,"customer")).filter(a=>!!a),...e.map(a=>D(a,"customer"))],b);return console.log("[customer activity] feed result",{customerId:a.customerId??null,email:a.email??null,domain:a.domain??null,count:f.length}),f}async function p(a){var b;let c=a.limit??10,e=a.supplierId??null,h=(b=a.supplierEmail,(0,d.u_)(b)),j={label:l,supplierId:e,supplierEmail:h,loader:"activity"},k={supplierId:e,supplierEmail:h,loader:"activity"},m=(0,g.WF)();if(!e&&!h)return console.warn("[supplier activity] loading skipped",{...k,error:"Missing supplier identity"}),{ok:!1,data:[],error:"Missing supplier identity"};if(console.log("[supplier activity] loading",k),(0,g.Ef)()){let a=e?await (0,i.n1)(e):h?await (0,i.iB)(h):null,b=(0,i.WP)(a??void 0);if(!(0,i.m9)(a??void 0))return console.log("[supplier activity] approvals gate active",{...k,approvalStatus:b}),{ok:!0,data:[],approvalGate:{enabled:!0,status:b}}}if(!m)return console.log("[supplier activity] assignments disabled: skipping activity feed",{...k}),{ok:!0,data:[]};try{let a=h?await A(h,j):[],b=await y({supplierId:e},3*c,!1,j),d=b.map(a=>a.quote_id),f=await r({quoteIds:Array.from(new Set([...a,...d])),supplierEmail:h,limit:Math.max(2*c,20)},j,m),g=[...f.map(a=>B(a,"supplier")),...f.map(a=>C(a,"supplier")).filter(a=>!!a),...b.map(a=>D(a,"supplier"))],i=E(g,c);return console.log("[supplier activity] quote query result",{...k,count:i.length}),{ok:!0,data:i}}catch(a){return(0,f.aH)({loader:j.loader,supplierId:j.supplierId,supplierEmail:j.supplierEmail,query:(0,f.qr)(a,"supplier_activity_feed"),error:a,stage:"loader"}),{ok:!1,data:[],error:"Unable to load activity right now"}}}async function q(a){var b;let{customerId:c,email:e,domain:f,limit:g}=a,h=[];c&&h.push(()=>H(c,g));let i=(b=e,(0,d.u_)(b));i&&h.push(()=>s(a=>a.ilike("email",i).limit(g)));let j=function(a){if(!a)return null;let b=a.trim().toLowerCase();return b.length>0?b.replace(/^@/,""):null}(f);for(let a of(j&&h.push(()=>s(a=>a.ilike("email",`%@${j}`).limit(g))),h)){let b=await a();if(b.length>0)return b}return[]}async function r(a,b,c){let{quoteIds:d,supplierEmail:e,limit:f}=a,g=c??!0;return d.length>0?s(a=>a.in("id",d).limit(f),b):e?s(a=>a.or([`email.ilike.${e}`,...g?[`assigned_supplier_email.ilike.${e}`]:[]].join(",")).limit(f),b):[]}async function s(a,b){let c=b?.label===l;try{let d=e.w9.from("quotes_with_uploads").select(m.join(",")).order("created_at",{ascending:!1}),g=a(d),{data:h,error:i}=await g;if(i){if(v(i,b))return w(b,i),[];if(t(i,b),c)throw(0,f.n0)("quotes_with_uploads",i);return[]}return h??[]}catch(a){if(v(a,b))return w(b,a),[];if(t(a,b),c)throw(0,f.n0)("quotes_with_uploads",a);return[]}}function t(a,b){let c=b?.label??"activity";if(c===l)return void(0,f.aH)({loader:b?.loader??null,supplierId:b?.supplierId??null,supplierEmail:b?.supplierEmail??null,query:"quotes_with_uploads",error:a,stage:b?.loader??null});console.error(`[${c}] quote query failed`,{loader:b?.loader??null,supplierId:b?.supplierId??null,supplierEmail:b?.supplierEmail??null,error:a instanceof Error?a.message:"object"==typeof a?JSON.stringify(a):String(a)})}function u(a,b,c,d){let e=c?.label??"activity";console.error(`[${e}] ${a}`,{loader:c?.loader??null,supplierId:c?.supplierId??null,supplierEmail:c?.supplierEmail??null,error:b instanceof Error?b.message:"object"==typeof b?JSON.stringify(b):String(b),...d})}function v(a,b){return b?.label===l&&(0,g.zD)(x(a))}function w(a,b){var c;console.warn("[supplier activity] assignments disabled: missing column",{loader:a?.loader??null,supplierId:a?.supplierId??null,supplierEmail:a?.supplierEmail??null,stage:a?.loader??null,supabaseError:(c=x(b))&&"object"==typeof c?{code:"string"==typeof c.code?c.code:null,message:"string"==typeof c.message?c.message:null,details:"string"==typeof c.details?c.details:null,hint:"string"==typeof c.hint?c.hint:null}:c??null})}function x(a){return a&&"object"==typeof a&&"supabaseError"in a&&a.supabaseError?a.supabaseError:a}async function y(a,b,c,d){if((!a.quoteIds||0===a.quoteIds.length)&&!a.supplierId)return[];try{let f=e.w9.from("supplier_bids").select("id,quote_id,supplier_id,unit_price,currency,status,lead_time_days,created_at,updated_at").order("updated_at",{ascending:!1}).limit(b);a.quoteIds&&a.quoteIds.length>0&&(f=f.in("quote_id",a.quoteIds)),a.supplierId&&(f=f.eq("supplier_id",a.supplierId));let{data:g,error:h}=await f;if(h)return u("bid query failed",h,d,a),[];let i=g??[];if(!c||0===i.length)return i;let j=Array.from(new Set(i.map(a=>a.supplier_id).filter(a=>!!a))),k=await z(j),l=new Map(k.map(a=>[a.id,a]));return i.map(a=>({...a,supplier:l.get(a.supplier_id??"")??null}))}catch(b){return u("bid query failed",b,d,a),[]}}async function z(a){if(0===a.length)return[];try{let{data:b,error:c}=await e.w9.from("suppliers").select("id,company_name,primary_email").in("id",a);if(c)return console.error("activity: supplier query failed",{error:c,supplierIds:a}),[];return b??[]}catch(b){return console.error("activity: supplier query error",{error:b,supplierIds:a}),[]}}async function A(a,b){if(!a)return[];try{let{data:c,error:d}=await e.w9.from("quote_suppliers").select("quote_id").ilike("supplier_email",a);if(d)return u("assignment query failed",d,b,{supplierEmail:a}),[];return(c??[]).map(a=>a.quote_id).filter(a=>!!a)}catch(c){return u("assignment query failed",c,b,{supplierEmail:a}),[]}}function B(a,b){let c=n[(0,j.Ao)(a.status??void 0)]??(0,j.RH)(a.status??void 0),d="customer"===b?"/customer/quotes":"/supplier/quotes";return{id:`${b}:quote:${a.id}`,type:"quote",title:`${F(a)}: ${c}`,description:function(a,b){let c=a.company??a.customer_name??a.email??("customer"===b?"your team":"customer");return"customer"===b?`Uploaded by ${c}`:`RFQ from ${c}`}(a,b),timestamp:G(a.created_at??a.updated_at),href:`${d}/${a.id}`}}function C(a,b){if(!a.updated_at||a.updated_at===a.created_at)return null;let c=n[(0,j.Ao)(a.status??void 0)]??(0,j.RH)(a.status??void 0);return{id:`${b}:status:${a.id}:${a.updated_at}`,type:"status",title:`${F(a)}: ${c}`,description:"customer"===b?"We updated this RFQ status in your workspace.":"Keep an eye on this RFQ so you can respond quickly.",timestamp:G(a.updated_at),href:`${"customer"===b?"/customer/quotes":"/supplier/quotes"}/${a.id}`}}function D(a,b){let c="customer"===b?"/customer/quotes":"/supplier/quotes",d=function(a){if(!a)return"Pending";let b=a.trim().toLowerCase();return b.charAt(0).toUpperCase()+b.slice(1)}(a.status),e=function(a,b){let c="string"==typeof a?Number(a):a;if("number"!=typeof c||Number.isNaN(c))return"Pricing pending";let d=(b??"USD").toUpperCase();try{return new Intl.NumberFormat("en-US",{style:"currency",currency:d,maximumFractionDigits:0}).format(c)}catch{return`${d} ${c.toFixed(0)}`}}(a.unit_price,a.currency),f="number"==typeof a.lead_time_days&&Number.isFinite(a.lead_time_days)?`${a.lead_time_days} day${1===a.lead_time_days?"":"s"}`:"Lead time pending";if("customer"===b){let b=a.supplier?.company_name??a.supplier?.primary_email??"Supplier partner";return{id:`customer:bid:${a.id}`,type:"bid",title:`${b} submitted a bid`,description:`${d} • ${e} • ${f}`,timestamp:G(a.updated_at??a.created_at),href:`${c}/${a.quote_id}`}}return{id:`supplier:bid:${a.id}`,type:"bid",title:`Bid ${d}`,description:`${e} • ${f}`,timestamp:G(a.updated_at??a.created_at),href:`${c}/${a.quote_id}`}}function E(a,b){let c=new Map;for(let b of a)c.has(b.id)||c.set(b.id,b);return Array.from(c.values()).sort((a,b)=>{let c=Date.parse(a.timestamp)||0;return(Date.parse(b.timestamp)||0)-c}).slice(0,b)}function F(a){return a.file_name?a.file_name:a.company?a.company:`Quote ${a.id.slice(0,6)}`}function G(a){return a&&!Number.isNaN(Date.parse(a))?a:new Date().toISOString()}async function H(a,b){if(!a)return[];let c=await (0,k.rC)(a);if(!c)return console.warn("selectQuotesByCustomerId: customer not found",{customerId:a}),[];let f=(0,d.u_)(c.email??null);if(!f)return console.warn("selectQuotesByCustomerId: customer missing email",{customerId:a}),[];console.log("selectQuotesByCustomerId: resolving via email",{customerId:a,email:f});try{let{data:c,error:d}=await e.w9.from("quotes_with_uploads").select(m.join(",")).ilike("email",f).order("created_at",{ascending:!1}).limit(b??20);if(d)return console.error("selectQuotesByCustomerId: query failed",{customerId:a,email:f,error:d}),[];return c??[]}catch(b){return console.error("selectQuotesByCustomerId: query failed",{customerId:a,email:f,error:b}),[]}}},72224:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/workspace/src/components/AppHeaderClient.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/src/components/AppHeaderClient.tsx","default")},78335:()=>{},96487:()=>{}};