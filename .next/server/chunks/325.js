exports.id=325,exports.ids=[325],exports.modules={5866:(a,b,c)=>{"use strict";c.d(b,{PortalLoginPanel:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call PortalLoginPanel() from the server but PortalLoginPanel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/src/app/(portals)/PortalLoginPanel.tsx","PortalLoginPanel")},8085:(a,b,c)=>{"use strict";c.d(b,{g:()=>g});var d=c(91488);c(27806);var e=c(65844),f=c(50904);async function g(a){var b,c;let d=(0,e.u_)(a.email);if(!d)return{success:!1,error:"supplier"===a.role?"Enter a business email that matches your onboarding profile.":"Enter a valid work email address."};let g=(0,f.qr)(),h=(b=a.nextPath,c=a.role,!b||"string"!=typeof b||!b.startsWith("/")||b.startsWith("//")||"/auth/callback"===b||b.startsWith("/auth/callback?")?"supplier"===c?"/supplier":"/customer":b);try{return await g.auth.signInWithOtp({email:d,options:{emailRedirectTo:`https://zartman.io/auth/callback?next=${encodeURIComponent(h)}`}}),{success:!0,normalizedEmail:d}}catch(b){return console.error("requestMagicLinkForEmail: failed to send OTP",{role:a.role,email:d,nextPath:h,error:b}),{success:!1,error:"We couldn’t send a magic link right now. Please try again."}}}(0,c(40410).D)([g]),(0,d.A)(g,"408cd5d58e8afbb5f4a90132b7d7a415a91d83f0e6",null)},26473:(a,b,c)=>{"use strict";c.d(b,{In:()=>j,TN:()=>h,kZ:()=>g,lG:()=>l});var d=c(50904);function e(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function f(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}async function g(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("customers").select("*").eq("user_id",a).maybeSingle();if(c)return console.error("getCustomerByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("getCustomerByUserId: unexpected error",{userId:a,error:b}),null}}async function h(a){let b=e(a.email);if(!b)throw Error("A valid email address is required.");let c=f(a.companyName)??b.split("@")[0]?.replace(/\W+/g," ").trim()??"Customer",h=f(a.phone),j=f(a.website);try{let e=await g(a.userId),f=await i(b);if(e)return await k(e.id,{company_name:c,phone:h,website:j});if(f)return await k(f.id,{user_id:a.userId,company_name:c,phone:h,website:j});let{data:l,error:m}=await d.w9.from("customers").insert({user_id:a.userId,email:b,company_name:c,phone:h,website:j}).select("*").single();if(m)return console.error("upsertCustomerProfileForUser: insert failed",{userId:a.userId,email:b,error:m}),null;return l??null}catch(c){return console.error("upsertCustomerProfileForUser: unexpected error",{userId:a.userId,email:b,error:c}),null}}async function i(a){let b=e(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("customers").select("*").eq("email",b).maybeSingle();if(c)return console.error("getCustomerByEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("getCustomerByEmail: unexpected error",{email:b,error:a}),null}}async function j(a,b){let c=e(b);if(a&&c)try{let{error:b}=await d.w9.from("quotes").update({customer_id:a,updated_at:new Date().toISOString()}).is("customer_id",null).ilike("email",c);b&&console.error("attachQuotesToCustomer: update failed",{customerId:a,email:c,error:b})}catch(b){console.error("attachQuotesToCustomer: unexpected error",{customerId:a,email:c,error:b})}}async function k(a,b){let{data:c,error:e}=await d.w9.from("customers").update({...b,updated_at:new Date().toISOString()}).eq("id",a).select("*").maybeSingle();return e?(console.error("updateCustomer: update failed",{customerId:a,changes:b,error:e}),null):c??null}async function l(a){let b=e(a.email);if(!b)throw Error("A valid email address is required.");let c=f(a.companyName)||b.split("@")[0]?.replace(/\W+/g," ").trim()||"Customer",g={email:b,company_name:c,phone:f(a.phone),updated_at:new Date().toISOString()};try{let{data:a,error:c}=await d.w9.from("customers").upsert(g,{onConflict:"email"}).select("*").single();if(c)return console.error("upsertCustomerByEmail: upsert failed",{email:b,payload:g,error:c}),null;return a??null}catch(a){return console.error("upsertCustomerByEmail: unexpected error",{email:b,error:a}),null}}},33271:(a,b,c)=>{"use strict";c.d(b,{OC:()=>k});var d=c(70495),e=c(69206),f=c(45180);let g="https://example.com",h="supabase-anon-key";if(!g||!h)throw Error("NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY must be set to enable auth.");async function i(){let a=(0,f.createServerClient)(g,h,{cookies:{getAll:async()=>(await (0,d.UL)()).getAll().map(a=>({name:a.name,value:a.value})),async setAll(a){let b=await (0,d.UL)();a.forEach(({name:a,value:c,options:d})=>{b.set({name:a,value:c,...d??{}})})}}}),{data:b,error:c}=await a.auth.getSession();return c?(console.error("getCurrentSession: failed to load session",c),null):b.session??null}class j extends Error{constructor(a="Authentication required"){super(a),this.name="UnauthorizedError"}}async function k(a){let b=await i();if(b)return b;throw a?.redirectTo&&(0,e.redirect)(a.redirectTo),new j(a?.message)}},42318:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>h});var d=c(75338),e=c(31143),f=c(5866),g=c(76522);async function h({children:a}){return await (0,g.qQ)()?(0,d.jsx)(e.A,{children:a}):(0,d.jsx)(e.A,{children:(0,d.jsx)(f.PortalLoginPanel,{role:"customer",fallbackRedirect:"/customer"})})}},50494:(a,b,c)=>{"use strict";c.d(b,{PortalLoginPanel:()=>j});var d=c(21124),e=c(38301),f=c(42378),g=c(85708);let h=(0,g.createServerReference)("408cd5d58e8afbb5f4a90132b7d7a415a91d83f0e6",g.callServer,void 0,g.findSourceMapURL,"requestMagicLinkForEmail"),i={customer:{title:"Sign in to the customer portal",description:"Use the email you shared with the Zartman team to receive your magic link.",accent:"text-emerald-300",cta:"Email me a link"},supplier:{title:"Sign in to your supplier workspace",description:"We’ll email a one-time magic link to the address tied to your onboarding profile. Use that same inbox to access RFQs.",accent:"text-blue-300",cta:"Send magic link"}};function j({role:a,fallbackRedirect:b}){let[c,g]=(0,e.useState)(""),[j,k]=(0,e.useState)("idle"),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(null),p=(0,f.usePathname)(),q="string"==typeof p&&p.startsWith(`/${a}`)?p:b;async function r(b){b.preventDefault();let d=c.trim().toLowerCase();if(!d||!d.includes("@")){m("supplier"===a?"Enter a business email that matches your onboarding profile.":"Enter a valid work email."),k("error");return}try{k("sending"),m(null);let b=await h({role:a,email:d,nextPath:q});if(!b.success){k("error"),m(b.error??("supplier"===a?"We couldn’t send the link. Check your connection and try again.":"We couldn’t send the link. Try again in a few seconds."));return}k("sent"),o(b.normalizedEmail??d)}catch(b){console.error("Portal login: failed to request magic link",b),m("supplier"===a?"We couldn’t send the link. Check your connection and try again.":"We couldn’t send the link. Try again in a few seconds."),k("error")}}let s=i[a];return(0,d.jsxs)("section",{className:"mx-auto max-w-lg rounded-2xl border border-slate-900 bg-slate-950/50 p-6",children:[(0,d.jsxs)("p",{className:`text-xs font-semibold uppercase tracking-[0.3em] ${s.accent}`,children:[a," portal"]}),(0,d.jsx)("h2",{className:"mt-2 text-xl font-semibold text-white",children:s.title}),(0,d.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:s.description}),(0,d.jsxs)("form",{onSubmit:r,className:"mt-5 space-y-3",children:[(0,d.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Work email"}),(0,d.jsx)("input",{type:"email",value:c,onChange:a=>g(a.target.value),className:"w-full rounded-lg border border-slate-800 bg-black/40 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-white focus:outline-none",placeholder:"you@company.com",required:!0}),(0,d.jsx)("button",{type:"submit",disabled:"sending"===j,className:"w-full rounded-full border border-slate-800 bg-white/90 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-white disabled:opacity-60",children:"sending"===j?"Sending...":s.cta}),"sent"===j?(0,d.jsx)("p",{className:"text-sm text-emerald-200",children:"supplier"===a?(0,d.jsxs)(d.Fragment,{children:["Link sent to"," ",(0,d.jsx)("span",{className:"font-mono text-white",children:n??c.trim().toLowerCase()})," ","– check your inbox."]}):"Check your inbox for the magic link."}):null,l?(0,d.jsx)("p",{className:"text-sm text-red-300",role:"alert",children:l}):null,(0,d.jsxs)("p",{className:"text-xs text-slate-500",children:["You’ll land back on ",(0,d.jsx)("span",{className:"font-mono text-slate-300",children:q})," after clicking the link."]})]})]})}},64811:(a,b,c)=>{"use strict";async function d(a){if(void 0!==a)return await a}function e(a,b){var c;if(!a)return;if(c=a,"function"==typeof c?.get)return a.get(b)??void 0;let d=a[b];return Array.isArray(d)?d[0]:d}function f(a){if(!a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){return a?a.startsWith("Q-")?a:`#${a.slice(0,6)}`:"Quote"}function h(a){return Array.isArray(a)?a[0]:a??void 0}c.d(b,{Ol:()=>d,VC:()=>e,nb:()=>h,u_:()=>f,xt:()=>g})},65844:(a,b,c)=>{"use strict";function d(a){if(!a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}c.d(b,{u_:()=>d})},84472:(a,b,c)=>{"use strict";c.d(b,{kZ:()=>e});var d=c(12831);async function e(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("customers").select("*").eq("user_id",a).maybeSingle();if(c)return console.error("getCustomerByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("getCustomerByUserId: unexpected error",{userId:a,error:b}),null}}},85947:(a,b,c)=>{Promise.resolve().then(c.bind(c,5866)),Promise.resolve().then(c.bind(c,72224))},96563:(a,b,c)=>{Promise.resolve().then(c.bind(c,50494)),Promise.resolve().then(c.bind(c,61530))}};