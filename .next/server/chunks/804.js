"use strict";exports.id=804,exports.ids=[804],exports.modules={32999:(a,b,c)=>{c.d(b,{m:()=>f,n4:()=>g,tJ:()=>h});let d="inline-flex items-center justify-center rounded-full font-semibold transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:cursor-not-allowed disabled:opacity-60",e={md:"px-5 py-2 text-sm",sm:"px-4 py-1.5 text-xs"},f=e,g=`${d} ${e.md} bg-emerald-400 text-slate-950 shadow-lift-sm hover:bg-emerald-300 focus-visible:outline-emerald-300`,h=`${d} ${e.md} border border-emerald-400/60 bg-transparent text-emerald-200 hover:bg-emerald-400/10 focus-visible:outline-emerald-400`},97778:(a,b,c)=>{c.d(b,{Pl:()=>s,fd:()=>m,yy:()=>r,wN:()=>t,jp:()=>h,D:()=>q,KP:()=>i,rs:()=>l});var d=c(50904);function e(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function f(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}function g(a){return Array.isArray(a)?a.map(a=>"string"==typeof a?a.trim():"").filter(a=>a.length>0):[]}async function h(a,b,c){let g=e(a);if(!g)throw Error("primaryEmail is required");try{let{data:a,error:e}=await d.w9.from("suppliers").select("*").eq("primary_email",g).maybeSingle();if(e&&console.error("getOrCreateSupplierByEmail: lookup failed",{email:g,error:e}),a){if(!a.user_id&&c){let{error:b}=await d.w9.from("suppliers").update({user_id:c}).eq("id",a.id);b?console.error("getOrCreateSupplierByEmail: failed to link user",{email:g,userId:c,error:b}):a.user_id=c}return a}let h={primary_email:g,company_name:f(b)??g.split("@")[0]?.replace(/\W+/g," ")?.trim()??"Supplier",phone:null,website:null,country:null,verified:!1,user_id:c??null},{data:i,error:j}=await d.w9.from("suppliers").insert(h).select("*").single();if(j||!i)throw console.error("getOrCreateSupplierByEmail: insert failed",{email:g,payload:h,error:j}),Error("Unable to create supplier record");return i}catch(a){throw console.error("getOrCreateSupplierByEmail: unexpected error",{email:g,error:a}),a}}async function i(a){let b=e(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select("*").eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierProfile: supplier lookup failed",{email:b,error:c}),null;if(!a)return null;let[e,f]=await Promise.all([n(a.id),o(a.id)]);return{supplier:a,capabilities:e,documents:f}}catch(a){return console.error("loadSupplierProfile: unexpected error",{email:b,error:a}),null}}async function j(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select("*").eq("id",a).maybeSingle();if(c)return console.error("loadSupplierById: lookup failed",{supplierId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierById: unexpected error",{supplierId:a,error:b}),null}}async function k(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select("*").eq("user_id",a).maybeSingle();if(c)return console.error("loadSupplierByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierByUserId: unexpected error",{userId:a,error:b}),null}}async function l(a){let b=e(a.primaryEmail);if(!b)throw Error("primaryEmail is required");let c=a.supplierId&&a.supplierId.length>0?await j(a.supplierId):null,g=!c&&a.userId?await k(a.userId):null,i=c??g??await h(b,a.companyName??void 0,a.userId??null),l={company_name:f(a.companyName)??i.company_name,phone:f(a.phone),website:f(a.website),country:f(a.country),primary_email:b,user_id:a.userId??i.user_id};try{let{data:b,error:c}=await d.w9.from("suppliers").update(l).eq("id",i.id).select("*").maybeSingle();if(c)throw console.error("upsertSupplierProfile: supplier update failed",{supplierId:i.id,error:c}),Error("Unable to update supplier record");let e=(a.capabilities??[]).filter(a=>"string"==typeof a?.process&&a.process.trim().length>0);await p(i.id,e);let[f,g]=await Promise.all([n(i.id),o(i.id)]);return{supplier:b??i,capabilities:f,documents:g}}catch(a){throw console.error("upsertSupplierProfile: unexpected error",{supplierId:i.id,error:a}),a}}async function m(a,b){if(!a)throw Error("supplierId is required");if(!b?.fileUrl)throw Error("fileUrl is required");let c={supplier_id:a,file_url:b.fileUrl,doc_type:f(b.docType)};try{let{data:b,error:e}=await d.w9.from("supplier_documents").insert(c).select("*").single();if(e)return console.error("addSupplierDocument: insert failed",{supplierId:a,error:e}),null;return b??null}catch(b){throw console.error("addSupplierDocument: unexpected error",{supplierId:a,error:b}),b}}async function n(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").eq("supplier_id",a).order("created_at",{ascending:!0});if(c)return console.error("listSupplierCapabilities: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierCapabilities: unexpected error",{supplierId:a,error:b}),[]}}async function o(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_documents").select("*").eq("supplier_id",a).order("uploaded_at",{ascending:!1});if(c)return console.error("listSupplierDocuments: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierDocuments: unexpected error",{supplierId:a,error:b}),[]}}async function p(a,b){try{let{error:c}=await d.w9.from("supplier_capabilities").delete().eq("supplier_id",a);if(c&&console.error("replaceSupplierCapabilities: delete failed",{supplierId:a,error:c}),0===b.length)return;let e=b.map(b=>({supplier_id:a,process:b.process.trim(),materials:g(b.materials),certifications:g(b.certifications),max_part_size:b.maxPartSize??null})),{error:f}=await d.w9.from("supplier_capabilities").insert(e);f&&console.error("replaceSupplierCapabilities: insert failed",{supplierId:a,error:f})}catch(b){console.error("replaceSupplierCapabilities: unexpected error",{supplierId:a,error:b})}}async function q(a,b){if(!a||!b)return null;try{let{data:c,error:e}=await d.w9.from("supplier_bids").select("*").eq("quote_id",a).eq("supplier_id",b).maybeSingle();if(e)return console.error("getSupplierBidForQuote: lookup failed",{quoteId:a,supplierId:b,error:e}),null;return c??null}catch(c){return console.error("getSupplierBidForQuote: unexpected error",{quoteId:a,supplierId:b,error:c}),null}}async function r(a){let{quoteId:b,supplierId:c}=a;if(!b||!c)throw Error("quoteId and supplierId are required");try{let e=await q(b,c),f=function(a){let b="string"==typeof a.unitPrice?Number(a.unitPrice):a.unitPrice,c="number"==typeof b&&Number.isFinite(b)?b:null,d="string"==typeof a.leadTimeDays?Number.parseInt(a.leadTimeDays,10):a.leadTimeDays,e="number"==typeof d&&Number.isFinite(d)?d:null;return{unit_price:c,currency:"string"==typeof a.currency&&a.currency.trim().length>0?a.currency.trim().toUpperCase():"USD",lead_time_days:e,notes:"string"==typeof a.notes&&a.notes.trim().length>0?a.notes.trim():null,supplier_id:a.supplierId,quote_id:a.quoteId}}(a);if(e){let{data:a,error:g}=await d.w9.from("supplier_bids").update({...f,updated_at:new Date().toISOString()}).eq("id",e.id).select("*").maybeSingle();if(g)return console.error("createOrUpdateBid: update failed",{quoteId:b,supplierId:c,error:g}),null;return a??null}let{data:g,error:h}=await d.w9.from("supplier_bids").insert({...f,quote_id:b,supplier_id:c,status:"pending"}).select("*").single();if(h)return console.error("createOrUpdateBid: insert failed",{quoteId:b,supplierId:c,error:h}),null;return g??null}catch(a){throw console.error("createOrUpdateBid: unexpected error",{quoteId:b,supplierId:c,error:a}),a}}async function s(a,b){if(!a||!b)throw Error("bidId and quoteId are required");try{let c=await u(a);if(!c||c.quote_id!==b)return console.error("acceptSupplierBidForQuote: mismatched bid/quote",{bidId:a,quoteId:b}),{accepted:null};let e=new Date().toISOString(),{data:f,error:g}=await d.w9.from("supplier_bids").update({status:"accepted",updated_at:e}).eq("id",a).select("*").maybeSingle();if(g||!f)return console.error("acceptSupplierBidForQuote: accept update failed",{bidId:a,quoteId:b,error:g}),{accepted:null};let{error:h}=await d.w9.from("supplier_bids").update({status:"declined",updated_at:e}).eq("quote_id",b).neq("id",a);h&&console.error("acceptSupplierBidForQuote: declining peers failed",{quoteId:b,error:h});let i=await j(f.supplier_id);return i&&await v(b,i),{accepted:f}}catch(c){throw console.error("acceptSupplierBidForQuote: unexpected error",{bidId:a,quoteId:b,error:c}),c}}async function t(a,b){if(!a)return null;try{let c=await u(a);if(!c)return null;let{data:e,error:f}=await d.w9.from("supplier_bids").update({status:"declined",updated_at:new Date().toISOString()}).eq("id",a).select("*").maybeSingle();if(f)return console.error("declineSupplierBid: update failed",{bidId:a,error:f}),null;return b&&"accepted"===c.status&&await d.w9.from("quotes").update({assigned_supplier_email:null,assigned_supplier_name:null,updated_at:new Date().toISOString()}).eq("id",b),e??null}catch(c){return console.error("declineSupplierBid: unexpected error",{bidId:a,quoteId:b,error:c}),null}}async function u(a){if(!a)return null;let{data:b,error:c}=await d.w9.from("supplier_bids").select("*").eq("id",a).maybeSingle();return c?(console.error("getBidById: lookup failed",{bidId:a,error:c}),null):b??null}async function v(a,b){try{let{error:c}=await d.w9.from("quotes").update({assigned_supplier_email:b.primary_email,assigned_supplier_name:b.company_name,updated_at:new Date().toISOString()}).eq("id",a);c&&console.error("updateQuoteAssignedSupplier: quote update failed",{quoteId:a,supplierId:b.id,error:c})}catch(c){console.error("updateQuoteAssignedSupplier: unexpected error",{quoteId:a,supplierId:b.id,error:c})}}}};