"use strict";exports.id=3474,exports.ids=[3474],exports.modules={2254:(a,b,c)=>{function d(a){return!!(a&&"object"==typeof a&&("query"in a||"supabaseError"in a))}function e(a,b){return d(b)?(b.query||(b.query=a),void 0===b.supabaseError&&(b.supabaseError=b),b):b instanceof Error?Object.assign(b,{query:a,supabaseError:b.supabaseError??b}):Object.assign(Error("string"==typeof b?b:null==b?"Unknown supplier activity error":JSON.stringify(b)),{query:a,supabaseError:b})}function f(a,b){return d(a)&&a.query?a.query:b}function g(a){console.error("[supplier activity] quote query failed",{loader:a.loader??null,supplierId:a.supplierId??null,supplierEmail:a.supplierEmail??null,query:a.query,stage:a.stage??null,supabaseError:function(a){var b;if((b=a)&&"object"==typeof b&&"code"in b&&"message"in b&&"details"in b&&"hint"in b)return{code:a.code??null,message:a.message??"Supabase error",details:a.details??null,hint:a.hint??null};if(a instanceof Error)return{code:"string"==typeof a.code?a.code:null,message:a.message,details:"string"==typeof a.details?a.details:null,hint:"string"==typeof a.hint?a.hint:null};if("object"==typeof a&&null!==a){let b="string"==typeof a.message?a.message:JSON.stringify(a);return{code:"string"==typeof a.code?a.code:null,message:b,details:"string"==typeof a.details?a.details:null,hint:"string"==typeof a.hint?a.hint:null}}return{code:null,message:null==a?"Unknown error":String(a),details:null,hint:null}}(d(a.error)&&a.error.supabaseError?a.error.supabaseError:a.error)})}c.d(b,{aH:()=>g,n0:()=>e,qr:()=>f})},28503:(a,b,c)=>{c.d(b,{Ef:()=>g,WF:()=>f,zD:()=>h});let d="true"===process.env.SUPPLIER_ASSIGNMENTS_ENABLED||"true"===process.env.NEXT_PUBLIC_SUPPLIER_ASSIGNMENTS_ENABLED,e="true"===process.env.SUPPLIER_APPROVALS_ENABLED||"true"===process.env.NEXT_PUBLIC_SUPPLIER_APPROVALS_ENABLED;function f(){return d}function g(){return e}function h(a){return!!a&&"object"==typeof a&&"42703"===("string"==typeof a.code?a.code:null)&&("string"==typeof a.message?a.message.toLowerCase():"").includes("assigned_supplier_email")}},43474:(a,b,c)=>{c.d(b,{Sy:()=>n,_K:()=>m,g1:()=>o});var d=c(12831),e=c(31023),f=c(49669),g=c(2254),h=c(28503);c(95641);let i="supplier_bids",j="Bids are not available in this environment.",k="We had trouble loading bids.",l="id,quote_id,supplier_id,unit_price,currency,lead_time_days,notes,status,created_at,updated_at";async function m(a){if(!a)return{ok:!1,data:[],error:"Quote ID is required."};try{let{data:b,error:c}=await d.w9.from(i).select(l).eq("quote_id",a).order("created_at",{ascending:!1});if(c){let b=(0,e.H)(c);if((0,e.uW)(c))return console.warn("[bids] list missing schema",{quoteId:a,error:b}),{ok:!1,data:[],error:j};return console.error("[bids] list query failed",{quoteId:a,error:b}),{ok:!1,data:[],error:k}}let f=(Array.isArray(b)?b:[])?.map(a=>p(a))??[];return{ok:!0,data:f.filter(a=>!!a),error:null}}catch(c){let b=(0,e.H)(c);if((0,e.uW)(c))return console.warn("[bids] list missing schema",{quoteId:a,error:b}),{ok:!1,data:[],error:j};return console.error("[bids] list crashed",{quoteId:a,error:b??c}),{ok:!1,data:[],error:k}}}async function n(a,b){if(!a||!b)return{ok:!1,data:null,error:"Supplier and quote are required."};try{let{data:c,error:f}=await d.w9.from(i).select(l).eq("quote_id",b).eq("supplier_id",a).maybeSingle();if(f){let c=(0,e.H)(f);if((0,e.uW)(f))return console.warn("[bids] detail missing schema",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:j};return console.error("[bids] detail query failed",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:k}}return{ok:!0,data:p(c),error:null}}catch(d){let c=(0,e.H)(d);if((0,e.uW)(d))return console.warn("[bids] detail missing schema",{supplierId:a,quoteId:b,error:c}),{ok:!1,data:null,error:j};return console.error("[bids] detail crashed",{supplierId:a,quoteId:b,error:c??d}),{ok:!1,data:null,error:k}}}async function o(a){let b=a.supplierId??null,c={supplierId:b,supplierEmail:function(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}(a.supplierEmail),loader:"bids"};if(!b)return console.warn("[supplier activity] loading skipped",{...c,error:"Missing supplier identity"}),{ok:!1,data:[],error:"Missing supplier identity"};console.log("[supplier activity] loading",c);try{if((0,h.Ef)()){let a=await (0,f.n1)(b);if(!a)return console.warn("[supplier activity] loading skipped",{...c,error:"Supplier profile missing"}),{ok:!1,data:[],error:"Supplier profile missing"};let d=(0,f.WP)(a);if(!(0,f.m9)(a))return console.log("[supplier activity] approvals gate active",{...c,approvalStatus:d}),{ok:!0,data:[],approvalGate:{enabled:!0,status:d}}}let{data:a,error:e}=await d.w9.from("supplier_bids").select("*").eq("supplier_id",b).order("updated_at",{ascending:!1});if(e)return(0,g.aH)({...c,query:"supplier_bids",error:e}),{ok:!1,data:[],error:"Unable to load bids right now"};let i=await q(a??[]);return console.log("[supplier activity] quote query result",{...c,count:i.length}),{ok:!0,data:i}}catch(a){return(0,g.aH)({...c,query:(0,g.qr)(a,"supplier_bids"),error:a}),{ok:!1,data:[],error:"Unable to load bids right now"}}}function p(a){return a?{id:a.id,quote_id:a.quote_id,supplier_id:a.supplier_id,amount:function(a){let b="string"==typeof a?Number(a):a;return"number"==typeof b&&Number.isFinite(b)?b:null}(a.unit_price),currency:a.currency??null,lead_time_days:"number"==typeof a.lead_time_days&&Number.isFinite(a.lead_time_days)?a.lead_time_days:null,notes:a.notes??null,status:a.status??null,created_at:a.created_at??null,updated_at:a.updated_at??null}:null}async function q(a){if(0===a.length)return[];let b=Array.from(new Set(a.map(a=>a.supplier_id).filter(Boolean))),[c,d]=await Promise.all([r(b),s(b)]),e=new Map;c.forEach(a=>e.set(a.id,a));let f=new Map;return d.forEach(a=>{let b=f.get(a.supplier_id)??[];(a.certifications??[]).filter(a=>"string"==typeof a&&a.trim().length>0).forEach(a=>{b.includes(a)||b.push(a)}),f.set(a.supplier_id,b)}),a.map(a=>({...a,supplier:e.get(a.supplier_id)??null,certifications:f.get(a.supplier_id)??[]}))}async function r(a){if(0===a.length)return[];let{data:b,error:c}=await d.w9.from("suppliers").select("*").in("id",a);return c?(console.error("selectSuppliersByIds: query failed",{supplierIds:a,error:c}),[]):b??[]}async function s(a){if(0===a.length)return[];let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").in("supplier_id",a);return c?(console.error("selectCapabilitiesBySupplierIds: query failed",{supplierIds:a,error:c}),[]):b??[]}},49669:(a,b,c)=>{c.d(b,{KF:()=>l,KP:()=>h,WP:()=>f,ZS:()=>k,iB:()=>i,m9:()=>g,n1:()=>j,n8:()=>m});var d=c(12831);function e(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function f(a){let b=(a?.status??"").toLowerCase().trim();return b?"approved"===b?"approved":"rejected"===b?"rejected":"pending":"unknown"}function g(a){return"approved"===f(a)}async function h(a){let b=e(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select("*").eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierProfile: supplier lookup failed",{email:b,error:c}),null;if(!a)return null;let[e,g]=await Promise.all([m(a.id),n(a.id)]),h=f(a);return{supplier:a,capabilities:e,documents:g,approvalStatus:h,approved:"approved"===h}}catch(a){return console.error("loadSupplierProfile: unexpected error",{email:b,error:a}),null}}async function i(a){let b=e(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select("*").eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierByPrimaryEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("loadSupplierByPrimaryEmail: unexpected error",{email:b,error:a}),null}}async function j(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select("*").eq("id",a).maybeSingle();if(c)return console.error("loadSupplierById: lookup failed",{supplierId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierById: unexpected error",{supplierId:a,error:b}),null}}async function k(a){let b=await l(a);if(!b)return null;let[c,d]=await Promise.all([m(b.id),n(b.id)]),e=f(b);return{supplier:b,capabilities:c,documents:d,approvalStatus:e,approved:"approved"===e}}async function l(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select("*").eq("user_id",a).maybeSingle();if(c)return console.error("loadSupplierByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierByUserId: unexpected error",{userId:a,error:b}),null}}async function m(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").eq("supplier_id",a).order("created_at",{ascending:!0});if(c)return console.error("listSupplierCapabilities: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierCapabilities: unexpected error",{supplierId:a,error:b}),[]}}async function n(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_documents").select("*").eq("supplier_id",a).order("uploaded_at",{ascending:!1});if(c)return console.error("listSupplierDocuments: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierDocuments: unexpected error",{supplierId:a,error:b}),[]}}},95641:(a,b,c)=>{c.d(b,{TT:()=>k,ZU:()=>l});var d=c(12831);c(33358);var e=c(25049),f=c(31023);let g=[...e.L],h=[...g],i="Unable to load quotes right now. Please refresh to try again.",j="Unable to load this quote right now.";async function k(a){try{let{data:b,error:c}=await d.w9.from("quotes_with_uploads").select(g.join(",")).order("created_at",{ascending:!1}).limit(100).returns();if(c)return(0,f.uW)(c)?(0,f.pU)("list missing schema",{status:a.status??null,search:a.search??null,supabaseError:(0,f.H)(c)}):(0,f.R0)("list query failed",{status:a.status??null,search:a.search??null,supabaseError:(0,f.H)(c)}),{ok:!1,data:[],error:i};let e=b??[];return(0,f.Ro)("list loaded",{count:e.length,status:a.status??null,search:a.search??null}),{ok:!0,data:e,error:null}}catch(b){return(0,f.R0)("list crashed",{status:a.status??null,search:a.search??null,supabaseError:(0,f.H)(b)}),{ok:!1,data:[],error:i}}}async function l(a){if("string"!=typeof a||0===a.trim().length)return(0,f.pU)("detail requested without id",{quoteId:a}),{ok:!0,data:null,error:null};try{let{data:b,error:c}=await d.w9.from("quotes_with_uploads").select(h.join(",")).eq("id",a).maybeSingle();if(c)return(0,f.uW)(c)?(0,f.pU)("detail missing schema",{quoteId:a,supabaseError:(0,f.H)(c)}):(0,f.R0)("detail query failed",{quoteId:a,supabaseError:(0,f.H)(c)}),{ok:!1,data:null,error:j};if(!b)return(0,f.Ro)("detail not found",{quoteId:a}),{ok:!0,data:null,error:null};let e=await m(a),g={...b,...e};return(0,f.Ro)("detail loaded",{quoteId:a}),{ok:!0,data:g,error:null}}catch(b){return(0,f.R0)("detail crashed",{quoteId:a,supabaseError:(0,f.H)(b)}),{ok:!1,data:null,error:j}}}async function m(a){let b={dfm_notes:null,internal_notes:null};try{let{data:c,error:e}=await d.w9.from("quotes").select("dfm_notes,internal_notes").eq("id",a).maybeSingle();if(e)return(0,f.uW)(e)?console.warn("[admin quotes] notes missing schema",{quoteId:a,supabaseError:(0,f.H)(e)}):console.error("[admin quotes] notes query failed",{quoteId:a,supabaseError:(0,f.H)(e)}),b;return c??b}catch(c){return console.error("[admin quotes] notes crashed",{quoteId:a,error:(0,f.H)(c)}),b}}}};