"use strict";exports.id=7082,exports.ids=[7082],exports.modules={4519:(a,b,c)=>{c.d(b,{QuoteFilesCard:()=>l});var d=c(21124),e=c(38301),f=c(43249);let g=(0,c(13973).default)(async()=>{},{loadableGenerated:{modules:["components/CadViewerClient.tsx -> ./CadViewer"]},ssr:!1,loading:()=>(0,d.jsx)(i,{})});function h(a){return(0,d.jsx)(g,{...a})}function i({height:a=320}){let b="number"==typeof a&&Number.isFinite(a)&&a>0?a:320;return(0,d.jsx)("div",{className:"w-full",children:(0,d.jsx)("div",{className:"relative overflow-hidden rounded-xl border border-slate-900/60 bg-slate-950/60",style:{height:b},children:(0,d.jsx)("div",{className:"flex h-full items-center justify-center px-6 text-center",children:(0,d.jsx)("p",{className:"text-sm text-slate-500",children:"Preparing 3D preview…"})})})})}function j({fileName:a,fileUrl:b,fallbackMessage:c,height:e=360}){return(0,d.jsx)(h,{src:b,fileName:a,fallbackMessage:c,height:e})}var k=c(32999);function l({files:a,id:b,className:c}){let[g,h]=(0,e.useState)(null),i=(0,e.useMemo)(()=>a.find(a=>a.id===g)??null,[g,a]),j=(0,e.useCallback)(()=>{h(null)},[]);return(0,d.jsxs)("section",{id:b,className:(0,f.A)("rounded-2xl border border-slate-800 bg-slate-950/60 px-5 py-4",c),children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Files"}),(0,d.jsx)("p",{className:"text-sm text-slate-400",children:"Click a file to open the 3D preview modal."})]}),(0,d.jsxs)("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:[a.length," attached"]})]}),(0,d.jsx)("div",{className:"mt-4 space-y-2",children:0===a.length?(0,d.jsx)("p",{className:"rounded-xl border border-dashed border-slate-900/70 bg-black/20 px-4 py-5 text-sm text-slate-500",children:"No files listed."}):a.map(a=>(0,d.jsxs)("button",{type:"button",onClick:()=>h(a.id),className:"group flex w-full items-center justify-between rounded-xl border border-slate-900/60 bg-slate-950/20 px-4 py-3 text-left transition hover:border-slate-800 hover:bg-slate-900/30 focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-400/70",children:[(0,d.jsxs)("div",{className:"min-w-0",children:[(0,d.jsx)("p",{className:"truncate text-sm font-medium text-slate-100",children:a.label}),(0,d.jsx)("p",{className:"mt-0.5 text-xs text-slate-500",children:a.signedUrl?"Interactive STL available":a.fallbackMessage??"Preview not available yet"})]}),(0,d.jsx)("span",{className:(0,f.A)(k.tJ,k.m.sm,"whitespace-nowrap",!a.signedUrl&&"opacity-70"),children:"View model"})]},a.id))}),i&&(0,d.jsx)(m,{file:i,onClose:j})]})}function m({file:a,onClose:b}){let c=(0,e.useRef)(null);return(0,e.useRef)(null),(0,d.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-8",children:[(0,d.jsx)("div",{className:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm",onClick:b,"aria-hidden":"true"}),(0,d.jsxs)("div",{ref:c,role:"dialog","aria-modal":"true","aria-label":`Preview for ${a.label}`,tabIndex:-1,className:"relative z-10 w-full max-w-3xl rounded-3xl border border-slate-800 bg-slate-950/95 shadow-2xl outline-none",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between border-b border-slate-900 px-6 py-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"File preview"}),(0,d.jsx)("h3",{className:"mt-1 text-lg font-semibold text-slate-50",children:a.label})]}),(0,d.jsx)("button",{type:"button",onClick:b,className:"rounded-full border border-slate-800 bg-slate-900/70 p-2 text-slate-400 transition hover:text-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-400/70","aria-label":"Close preview",children:(0,d.jsx)("svg",{viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",children:(0,d.jsx)("path",{d:"M5 5l10 10M15 5L5 15",stroke:"currentColor",strokeWidth:1.6,strokeLinecap:"round"})})})]}),(0,d.jsx)("div",{className:"px-6 py-6",children:(0,d.jsx)(j,{fileName:a.fileName??a.label,fileUrl:a.signedUrl,fallbackMessage:a.fallbackMessage})}),(0,d.jsx)("div",{className:"flex justify-end gap-3 border-t border-slate-900 px-6 py-4",children:(0,d.jsx)("button",{type:"button",onClick:b,className:(0,f.A)(k.tJ,k.m.sm),children:"Close"})})]})]})}},6173:(a,b,c)=>{c.d(b,{Q:()=>g});var d=c(12831),e=c(31023);let f=process.env.SUPABASE_CAD_BUCKET||process.env.NEXT_PUBLIC_CAD_BUCKET||process.env.NEXT_PUBLIC_SUPABASE_STORAGE_BUCKET||"cad";async function g(a,b){try{let c=b?.includeFilesTable!==!1,f=[];if(c)try{let{data:c,error:g}=await d.w9.from("files").select("storage_path,bucket_id,filename,mime").eq("quote_id",a.id).order("created_at",{ascending:!0});if(g){let c=(0,e.H)(g);(0,e.uW)(g)?console.warn("[admin uploads] files schema missing; treating as zero files",{quoteId:a.id,error:c}):console.error("Failed to load files for quote",{quoteId:a.id,error:c}),b?.onFilesError&&b.onFilesError(g)}else f=c??[]}catch(d){let c=(0,e.H)(d);console.error("Failed to load files for quote",{quoteId:a.id,error:c}),b?.onFilesError&&b.onFilesError(d)}let g=null;if(b&&Object.prototype.hasOwnProperty.call(b,"uploadFileOverride"))g=b?.uploadFileOverride??null;else if(a.upload_id){let{data:b,error:c}=await d.w9.from("uploads").select("file_path,file_name,mime_type").eq("id",a.upload_id).maybeSingle();c?console.error("Failed to load upload for quote",a.upload_id,c):g=b}let j=function(a,b){let c=[];return a?.forEach(a=>{a?.storage_path&&c.push({storagePath:a.storage_path,bucketId:a.bucket_id,fileName:a.filename,mime:a.mime})}),b?.file_path&&c.push({storagePath:b.file_path,bucketId:null,fileName:b.file_name}),c}(f??[],g),k=new Map,l=function(a){let b=[],c=a=>{"string"==typeof a&&a.trim().length>0&&b.push(a.trim())};return[a.file_names,a.upload_file_names].forEach(a=>{Array.isArray(a)&&a.forEach(c)}),0===b.length&&c(a.file_name),b}(a),m=j.map(a=>a.fileName??i(a.storagePath)??null).filter(a=>!!a?.trim()),n=l.length>0?l:m.length>0?m:[],o=[],p=new Set;for(let a=0;a<n.length;a+=1){let b=n[a]||`File ${a+1}`,c=function(a,b){let c=a?.toLowerCase().trim();if(c)return b.find(a=>{let b=a.fileName?.toLowerCase().trim();return!!b&&b===c||(i(a.storagePath)?.toLowerCase().trim()??"")===c})}(b,j);c&&p.add(c.storagePath);let d=c?await h(c,k):{signedUrl:null,fileName:b,reason:"Preview not available for this file yet."};o.push({id:c?.storagePath??`${a}-${b}`,label:b,fileName:d.fileName??b,signedUrl:d.signedUrl,fallbackMessage:d.reason})}for(let[a,b]of j.filter(a=>!p.has(a.storagePath)).entries()){let c=b.fileName??i(b.storagePath)??`File ${o.length+1}`,d=await h(b,k);o.push({id:`${b.storagePath}-${a}`,label:c,fileName:d.fileName??c,signedUrl:d.signedUrl,fallbackMessage:d.reason})}return o}catch(a){return console.error("Unexpected CAD preview error",a),[]}}async function h(a,b){let c,e=`${a.bucketId??"default"}:${a.storagePath}`;if(b.has(e))return b.get(e);if(!function(a){let b=a.fileName?.toLowerCase()??"",c=a.storagePath.toLowerCase(),d=a.mime?.toLowerCase()??"";return b.endsWith(".stl")||c.endsWith(".stl")||d.includes("stl")}(a))return c={signedUrl:null,fileName:a.fileName??i(a.storagePath)??void 0,reason:"Only STL files are supported for preview today."},b.set(e,c),c;let g=function(a,b){if(!a)return null;let c=a.trim().replace(/^\/+/,"");if(!c)return null;let d=b?.trim()||null;return(!d&&c.startsWith(`${f}/`)&&(d=f,c=c.slice(f.length+1)),d||(d=f),c.startsWith(`${d}/`)&&(c=c.slice(d.length+1)),c)?{bucket:d,path:c}:null}(a.storagePath,a.bucketId);if(!g)return c={signedUrl:null,fileName:a.fileName??i(a.storagePath)??void 0,reason:"Missing storage path for CAD file."},b.set(e,c),c;let{data:h,error:j}=await d.w9.storage.from(g.bucket).createSignedUrl(g.path,3600);return j||!h?.signedUrl?(console.error("Failed to create CAD signed URL",j),c={signedUrl:null,fileName:a.fileName??i(a.storagePath)??void 0,reason:"Unable to generate CAD preview link right now."}):c={signedUrl:h.signedUrl,fileName:a.fileName??i(a.storagePath)??void 0},b.set(e,c),c}function i(a){if(!a)return;let b=a.split("/");return b[b.length-1]||void 0}},9965:(a,b,c)=>{c.d(b,{r:()=>e});let d="en-US";function e(a,{includeTime:b=!1,fallback:c="—"}={}){let f=function(a){if(null==a)return null;let b=a instanceof Date?a:new Date(a);return Number.isNaN(b.getTime())?null:b}(a);if(!f)return c;let g=f.toLocaleDateString(d,{month:"short",day:"numeric",year:"numeric"});if(!b)return g;let h=f.toLocaleTimeString(d,{hour:"numeric",minute:"2-digit"});return`${g} \xb7 ${h}`}},13951:(a,b,c)=>{c.d(b,{t:()=>j});var d=c(75338),e=c(81171),f=c(9965);let g={admin:"border-emerald-500/40 bg-emerald-500/10 text-emerald-300",customer:"border-sky-500/40 bg-sky-500/10 text-sky-300",supplier:"border-amber-500/40 bg-amber-500/10 text-amber-200"},h={admin:"Admin",customer:"Customer",supplier:"Supplier"},i={admin:"bg-emerald-400 text-slate-950 border border-emerald-300/70 shadow-lift-sm",customer:"bg-slate-900 text-slate-100 border border-slate-800/80",supplier:"bg-blue-500/80 text-slate-950 border border-blue-300/70"};function j({messages:a,heading:b,description:c,messageCount:j,isLoading:l,error:m,emptyState:n,containerClassName:o}){let p=a??[],q="number"==typeof j?j:p.length,r=p.length>0;return(0,d.jsxs)("div",{className:(0,e.A)("space-y-3",o),children:[(!!b||!!c||"number"==typeof j)&&(0,d.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[(0,d.jsxs)("div",{className:"space-y-1",children:[b?(0,d.jsx)("h2",{className:"text-lg font-semibold text-slate-50",children:b}):null,c?(0,d.jsx)("p",{className:"text-sm text-slate-400",children:c}):null]}),(0,d.jsxs)("span",{className:"text-xs text-slate-500",children:[q," ",1===q?"message":"messages"]})]}),m&&(0,d.jsx)("p",{className:"rounded-xl border border-red-500/30 bg-red-500/10 px-3 py-2 text-xs text-red-200",role:"status",children:m}),l?(0,d.jsx)(k,{}):r?(0,d.jsx)("div",{className:"md:max-h-[420px] md:overflow-y-auto md:pr-2",children:(0,d.jsx)("ol",{className:"flex flex-col gap-3",children:p.map(a=>{var b;let c="admin"===a.author_type;return(0,d.jsx)("li",{className:(0,e.A)("flex w-full",c?"justify-end":"justify-start"),children:(0,d.jsxs)("div",{className:"flex max-w-[92%] flex-col gap-1.5 sm:max-w-[70%]",children:[(0,d.jsxs)("div",{className:(0,e.A)("flex flex-wrap items-center gap-2 text-[11px] font-semibold uppercase tracking-wide text-slate-500",c?"justify-end text-right":"text-left"),children:[(0,d.jsx)("span",{className:(b=a.author_type,`inline-flex items-center rounded-full border px-2.5 py-0.5 text-[11px] font-semibold uppercase tracking-wide ${g[b]??g.admin}`),children:h[a.author_type]??h.admin}),(0,d.jsx)("span",{className:"text-slate-400",children:(0,f.r)(a.created_at,{includeTime:!0})}),a.author_name&&(0,d.jsx)("span",{className:"text-slate-500",children:a.author_name})]}),(0,d.jsx)("div",{className:(0,e.A)("whitespace-pre-line rounded-2xl border px-3.5 py-2.5 text-sm leading-relaxed",i[a.author_type]??i.customer,c?"rounded-tr-sm":"rounded-tl-sm"),children:a.body})]})},a.id)})})}):n??(0,d.jsx)("p",{className:"rounded-2xl border border-dashed border-slate-800/70 bg-black/30 px-4 py-4 text-sm text-slate-400",children:"No messages yet. Share the first update to kick things off."})]})}function k(){return(0,d.jsx)("div",{className:"space-y-3",children:[0,1,2].map(a=>(0,d.jsx)("div",{className:(0,e.A)("flex justify-start",a%2==0?"justify-end":"justify-start"),children:(0,d.jsxs)("div",{className:"flex max-w-[75%] flex-col gap-2",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3 text-[11px] text-slate-600",children:[(0,d.jsx)("span",{className:"inline-flex h-4 w-20 animate-pulse rounded-full bg-slate-800/70"}),(0,d.jsx)("span",{className:"inline-flex h-3 w-24 animate-pulse rounded-full bg-slate-900/60"})]}),(0,d.jsx)("div",{className:"h-16 animate-pulse rounded-2xl bg-slate-900/60"})]})},a))})}},16616:(a,b,c)=>{c.d(b,{Sy:()=>d.Sy,_K:()=>d._K});var d=c(43474)},26303:(a,b,c)=>{c.d(b,{l:()=>g,r:()=>f});let d="en-US";function e(a){if(null==a)return null;let b=a instanceof Date?a:new Date(a);return Number.isNaN(b.getTime())?null:b}function f(a,{includeTime:b=!1,fallback:c="—"}={}){let g=e(a);if(!g)return c;let h=g.toLocaleDateString(d,{month:"short",day:"numeric",year:"numeric"});if(!b)return h;let i=g.toLocaleTimeString(d,{hour:"numeric",minute:"2-digit"});return`${h} \xb7 ${i}`}function g(a){let b=e(a);return b?b.toISOString().slice(0,10):""}},33271:(a,b,c)=>{c.d(b,{OC:()=>n,qQ:()=>l});var d=c(70495),e=c(69206),f=c(45180);let g="https://qslztdkptpklopyedkfd.supabase.co/",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzbHp0ZGtwdHBrbG9weWVka2ZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTYzMzksImV4cCI6MjA3ODk5MjMzOX0.et6RdF18ioinJKYNNTE0UVA5HvRH1YaXmA2DgRHLPWo";if(!g||!h)throw Error("NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY must be set to enable auth.");async function i(){let a=await (0,d.UL)();return(0,f.createServerClient)(g,h,{cookies:{get:b=>a.get(b)?.value,set(){},remove(){}}})}let j="DYNAMIC_SERVER_USAGE";function k(a){if(!a)return!1;let b=a=>{if(!a)return!1;if("string"==typeof a)return a.startsWith(j);if("object"==typeof a){let c=a.digest;if("string"==typeof c&&c.startsWith(j))return!0;let d=a.cause;if(d&&b(d))return!0}return!1};return b(a)||a instanceof Error&&b(a.message)}async function l(){try{let a=await (0,d.UL)(),b="function"==typeof a.getAll?a.getAll().map(a=>a.name):[];console.log("[auth] cookies seen by server:",b);let c=await i(),{data:e,error:f}=await c.auth.getSession(),g=!!e.session;if(console.log("[auth] getSession result:",{hasSession:g,email:e.session?.user?.email??null,error:f?.message??null}),f){if(k(f))return console.info("[auth] getSession run skipped during static generation (dynamic route only)"),null;return console.error("[auth] getSession failed",f),null}return g||console.warn("[auth] no active session returned by Supabase"),e.session??null}catch(a){if(k(a))return console.info("[auth] getCurrentSession skipped during static generation (dynamic route only)"),null;return console.error("[auth] getCurrentSession: unexpected failure",a),null}}class m extends Error{constructor(a="Authentication required"){super(a),this.name="UnauthorizedError"}}async function n(a){let b=await l();if(b)return b;throw a?.redirectTo&&(0,e.redirect)(a.redirectTo),new m(a?.message)}},37331:(a,b,c)=>{c.d(b,{QuoteFilesCard:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call QuoteFilesCard() from the server but QuoteFilesCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/src/app/admin/quotes/[id]/QuoteFilesCard.tsx","QuoteFilesCard")},46713:(a,b,c)=>{c.d(b,{Sy:()=>d.Sy,qn:()=>d.qn});var d=c(39455)},81164:(a,b,c)=>{c.d(b,{v:()=>d});function d(a,b,c){if("number"!=typeof a||Number.isNaN(a))return"—";let d=(b??"USD").toUpperCase(),e=c?.maximumFractionDigits??0,f=c?.minimumFractionDigits??e;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:d,minimumFractionDigits:f,maximumFractionDigits:e}).format(a)}catch{let b=Math.max(f,e);return`${d} ${a.toFixed(b)}`}}},81320:(a,b,c)=>{c.d(b,{xF:()=>e});var d=c(12831);async function e(a){let b=a?.trim();if(!b)return{messages:[],error:"quoteId is required"};try{let{data:c,error:e}=await d.w9.from("quote_messages").select("id,quote_id,author_type,author_name,author_email,body,created_at").eq("quote_id",b).order("created_at",{ascending:!0});if(e)return console.error("loadQuoteMessages: query failed",{quoteId:a,error:e}),{messages:[],error:"Unable to load messages right now."};return{messages:c??[],error:null}}catch(a){return console.error("loadQuoteMessages: unexpected error",{quoteId:b,error:a}),{messages:[],error:"Unable to load messages right now."}}}},82393:(a,b,c)=>{c.d(b,{Ak:()=>f,ES:()=>g,hX:()=>e});var d=c(50904);async function e({quoteId:a,body:b}){return h({quoteId:a,body:b,authorType:"admin",authorName:"Zartman admin",authorEmail:null})}async function f({quoteId:a,body:b,authorName:c,authorEmail:d}){return h({quoteId:a,body:b,authorType:"customer",authorName:i(c),authorEmail:j(d)})}async function g({quoteId:a,body:b,authorName:c,authorEmail:d}){return h({quoteId:a,body:b,authorType:"supplier",authorName:i(c),authorEmail:j(d)})}async function h({quoteId:a,body:b,authorType:c,authorName:e,authorEmail:f}){let g=a?.trim(),h=b?.trim(),i="admin"===c||"customer"===c||"supplier"===c?c:null,j="string"==typeof e?e.trim().slice(0,120):null,k="string"==typeof f?f.trim().toLowerCase():null;if(!g||!h||!i)return{data:null,error:"Missing message parameters."};try{let{data:a,error:b}=await d.w9.from("quote_messages").insert({quote_id:g,author_type:i,author_name:j,author_email:k,body:h}).select("id,quote_id,author_type,author_name,author_email,body,created_at").single();if(b||!a)return console.error("createQuoteMessage: insert failed",{quoteId:g,authorType:i,error:b}),{data:null,error:"Failed to post message."};return{data:a,error:null}}catch(a){return console.error("createQuoteMessage: unexpected error",a),{data:null,error:"Failed to post message."}}}function i(a){if("string"!=typeof a)return null;let b=a.trim().slice(0,120);return b.length>0?b:null}function j(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}},88437:(a,b,c)=>{c.d(b,{QuoteWorkspaceTabs:()=>g});var d=c(21124),e=c(38301),f=c(43249);function g({tabs:a,defaultTab:b="summary"}){let c=(0,e.useId)(),[g,h]=(0,e.useState)(a.find(a=>a.id===b)?.id??a[0]?.id??"summary"),i=(0,e.useMemo)(()=>a.filter((a,b,c)=>a&&"string"==typeof a.id&&c.findIndex(b=>b.id===a.id)===b),[a]);return 0===i.length?null:(0,d.jsxs)("div",{className:"space-y-5",children:[(0,d.jsx)("div",{className:"overflow-x-auto pb-1",children:(0,d.jsx)("div",{className:"flex min-w-max gap-2",role:"tablist","aria-label":"Quote workspace navigation",children:i.map(a=>{let b=a.id===g,e=`${c}-tab-${a.id}`,i=`${c}-panel-${a.id}`;return(0,d.jsxs)("button",{id:e,type:"button",role:"tab","aria-selected":b,"aria-controls":i,onClick:()=>h(a.id),className:(0,f.A)("rounded-full border px-3 py-1 text-xs font-semibold transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400",b?"border-emerald-400 bg-emerald-500/20 text-emerald-100 shadow-[0_0_25px_rgba(16,185,129,0.25)]":"border-slate-800 bg-slate-900/70 text-slate-300 hover:border-emerald-400 hover:text-emerald-100"),children:[(0,d.jsx)("span",{children:a.label}),"number"==typeof a.count&&(0,d.jsx)("span",{className:(0,f.A)("ml-2 rounded-full border px-2 py-0.5 text-[10px]",b?"border-transparent bg-slate-900/40 text-emerald-100/80":"border-slate-800 bg-slate-950/70 text-slate-400"),children:a.count})]},a.id)})})}),(0,d.jsx)("div",{children:i.map(a=>{let b=a.id===g,e=`${c}-panel-${a.id}`,h=`${c}-tab-${a.id}`;return(0,d.jsx)("div",{id:e,role:"tabpanel","aria-labelledby":h,className:(0,f.A)("space-y-4",b?"block":"hidden"),"aria-hidden":!b,children:a.content},a.id)})})]})}},98719:(a,b,c)=>{c.d(b,{QuoteWorkspaceTabs:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call QuoteWorkspaceTabs() from the server but QuoteWorkspaceTabs is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspace/src/app/admin/quotes/[id]/QuoteWorkspaceTabs.tsx","QuoteWorkspaceTabs")}};