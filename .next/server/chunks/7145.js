"use strict";exports.id=7145,exports.ids=[7145],exports.modules={15656:(a,b,c)=>{function d(a){return a&&"object"==typeof a&&"supabaseError"in a&&a.supabaseError?a.supabaseError:a}function e(a){let b=d(a);return b&&"object"==typeof b?{code:"string"==typeof b.code?b.code:null,message:"string"==typeof b.message?b.message:null,details:"string"==typeof b.details?b.details:null,hint:"string"==typeof b.hint?b.hint:null}:b??null}c.d(b,{H:()=>e,uW:()=>g});let f=new Set(["PGRST205","42703"]);function g(a){let b=d(a);if(!b||"object"!=typeof b)return!1;let c="code"in b&&"string"==typeof b.code?b.code:null;return!!c&&f.has(c)}},23867:(a,b,c)=>{c.d(b,{Ao:()=>f,Hk:()=>e,_A:()=>d});let d="submitted",e=["submitted","in_review","quoted"];function f(a){let b=(a??"").toLowerCase().trim();return"in_review"===b?"in_review":"quote_prepared"===b||"quoted"===b?"quoted":"approved"===b?"approved":"won"===b?"won":"lost"===b?"lost":"cancelled"===b||"canceled"===b?"cancelled":"submitted"}},26473:(a,b,c)=>{c.d(b,{In:()=>k,TN:()=>i,kZ:()=>h,lG:()=>m});var d=c(50904);let e="id,user_id,email,company_name,created_at,notify_quote_messages,notify_quote_winner";function f(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}async function h(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("customers").select(e).eq("user_id",a).maybeSingle();if(c)return console.error("getCustomerByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("getCustomerByUserId: unexpected error",{userId:a,error:b}),null}}async function i(a){let b=f(a.email);if(!b)return{ok:!1,error:"Your session is missing a valid email address.",details:{reason:"missing-email"}};let c=g(a.companyName)??b.split("@")[0]?.replace(/\W+/g," ").trim()??"Customer",i=g(a.phone),k=g(a.website);try{let f=await h(a.userId),g=await j(b);if(f){let a=await l(f.id,{company_name:c,phone:i,website:k});if(!a)return{ok:!1,error:"We couldn’t update your existing profile record.",details:{reason:"update-existing-user",customerId:f.id}};return{ok:!0,customer:a,operation:"updated_user"}}if(g){let b=await l(g.id,{user_id:a.userId,company_name:c,phone:i,website:k});if(!b)return{ok:!1,error:"We couldn’t link your profile to this account.",details:{reason:"update-existing-email",customerId:g.id}};return{ok:!0,customer:b,operation:"linked_email"}}let n={user_id:a.userId,email:b,company_name:c,phone:i,website:k,updated_at:new Date().toISOString()},{data:o,error:p}=await d.w9.from("customers").insert(n).select(e).single();if(p||!o){var m;if(m=p,m?.code&&"23505"===m.code){let d=await j(b);if(d){let b=await l(d.id,{user_id:a.userId,company_name:c,phone:i,website:k});if(b)return{ok:!0,customer:b,operation:"linked_email"}}}return console.error("upsertCustomerProfileForUser: insert failed",{userId:a.userId,email:b,payload:n,error:p}),{ok:!1,error:"We couldn’t create your customer profile right now.",details:p}}return{ok:!0,customer:o,operation:"inserted"}}catch(c){return console.error("upsertCustomerProfileForUser: unexpected error",{userId:a.userId,email:b,error:c}),{ok:!1,error:"Unexpected error while saving your customer profile.",details:c}}}async function j(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("customers").select(e).ilike("email",b).maybeSingle();if(c)return console.error("getCustomerByEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("getCustomerByEmail: unexpected error",{email:b,error:a}),null}}async function k(a,b){let c=f(b);if(a&&c)try{let{error:b}=await d.w9.from("quotes").update({customer_id:a,updated_at:new Date().toISOString()}).is("customer_id",null).ilike("email",c);b&&console.error("attachQuotesToCustomer: update failed",{customerId:a,email:c,error:b})}catch(b){console.error("attachQuotesToCustomer: unexpected error",{customerId:a,email:c,error:b})}}async function l(a,b){let{data:c,error:f}=await d.w9.from("customers").update({...b,updated_at:new Date().toISOString()}).eq("id",a).select(e).maybeSingle();return f?(console.error("updateCustomer: update failed",{customerId:a,changes:b,error:f}),null):c??null}async function m(a){let b=f(a.email);if(!b)throw Error("A valid email address is required.");let c=g(a.companyName)||b.split("@")[0]?.replace(/\W+/g," ").trim()||"Customer",h={email:b,company_name:c,phone:g(a.phone),updated_at:new Date().toISOString()};try{let{data:a,error:c}=await d.w9.from("customers").upsert(h,{onConflict:"email"}).select(e).single();if(c)return console.error("upsertCustomerByEmail: upsert failed",{email:b,payload:h,error:c}),null;return a??null}catch(a){return console.error("upsertCustomerByEmail: unexpected error",{email:b,error:a}),null}}},27152:(a,b,c)=>{c.d(b,{CT:()=>n,VJ:()=>m}),c(50904);let d=process.env.RESEND_API_KEY,e=process.env.NOTIFICATIONS_FROM_EMAIL??"Zartman <notifications@zartman.io>";async function f(a){var b;if(!a?.to)return void console.warn("[notifications] missing recipient email",{subject:a?.subject??null});if(!d)return void console.warn("[notifications] RESEND_API_KEY not configured; email skipped",{to:a.to,subject:a.subject});let c={from:e,to:a.to,subject:a.subject,html:a.previewText?`${b=a.previewText,`<div style="display:none;font-size:1px;color:#fefefe;line-height:1px;max-height:0px;max-width:0px;opacity:0;overflow:hidden;">${b}</div>`}${a.html}`:a.html};try{let b=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!b.ok){let c=await g(b);console.error("[notifications] email send failed",{to:a.to,subject:a.subject,status:b.status,error:c})}}catch(b){console.error("[notifications] email send crashed",{to:a.to,subject:a.subject,error:b instanceof Error?{message:b.message,stack:b.stack}:String(b)})}}async function g(a){try{return await a.json()}catch{return{statusText:a.statusText}}}async function h(a,b){let c=j(a);console.log("[notifications] dispatch start",c);try{return await b(),console.log("[notifications] dispatch success",c),!0}catch(a){var d;return console.error("[notifications] dispatch failed",{...c,error:(d=a)instanceof Error?{name:d.name,message:d.message,stack:d.stack}:d&&"object"==typeof d?{...d}:d??null}),!1}}async function i(a){let{subject:b,previewText:c,html:d,skipIfMissingRecipient:e=!0,...g}=a,i=g.recipientEmail??null,k=j({...g,recipientEmail:i});return!i&&e?(console.warn("[notifications] dispatch skipped",{...k,reason:"missing-recipient"}),!1):h({...g,recipientEmail:i,channel:g.channel??"email"},()=>f({to:i??"",subject:b,previewText:c,html:d}))}function j(a){return{eventType:a.eventType,quoteId:a.quoteId??null,recipientEmail:a.recipientEmail??null,audience:a.audience??null,channel:a.channel??null,payload:a.payload??null}}c(52453),c(23867);let k=process.env.NOTIFICATIONS_ADMIN_EMAIL??"admin@zartman.io";function l(a){return`https://zartman.io${a}`}async function m(a){await i({eventType:"quote_submitted",quoteId:a.quoteId,recipientEmail:k,audience:"admin",payload:{contactEmail:a.contactEmail,company:a.company??null},subject:`New RFQ submitted by ${a.contactName||a.contactEmail}`,previewText:`${a.contactEmail} uploaded ${a.fileName??"an RFQ"}.`,html:function(a){let b=l(`/admin/quotes/${a.quoteId}`),c=o(a.company)??"Not provided",d=o(a.contactName)??a.contactEmail,e=o(a.fileName)??"Untitled RFQ";return`
    <p><strong>${d}</strong> just submitted a new RFQ.</p>
    <p>Email: ${a.contactEmail}<br/>
    Company: ${c}<br/>
    File: ${e}</p>
    <p><a href="${b}">Review in the admin workspace</a></p>
  `}(a)})}async function n(a){await i({eventType:"bid_submitted",quoteId:a.quoteId,recipientEmail:k,audience:"admin",payload:{bidId:a.bidId,supplierId:a.supplierId},subject:`New bid from ${a.supplierName??"a supplier"} on ${a.quoteTitle}`,previewText:`${a.quoteTitle} just received a bid.`,html:function(a){let b="number"==typeof a.amount?function(a,b,c){if("number"!=typeof a||Number.isNaN(a))return"—";let d=(b??"USD").toUpperCase(),e=(void 0)??0,f=(void 0)??e;try{return new Intl.NumberFormat("en-US",{style:"currency",currency:d,minimumFractionDigits:f,maximumFractionDigits:e}).format(a)}catch{let b=Math.max(f,e);return`${d} ${a.toFixed(b)}`}}(a.amount,a.currency??"USD"):"Pricing pending",c="number"==typeof a.leadTimeDays&&Number.isFinite(a.leadTimeDays)?`${a.leadTimeDays} day${1===a.leadTimeDays?"":"s"}`:"Lead time pending",d=l(`/admin/quotes/${a.quoteId}`),e=o(a.supplierName)??"Supplier partner",f=o(a.supplierEmail)??"Not provided";return`
    <p><strong>${e}</strong> submitted a bid on <strong>${a.quoteTitle}</strong>.</p>
    <p>${b} • ${c}<br/>Email: ${f}</p>
    <p><a href="${d}">Review the bid</a></p>
  `}(a)})}function o(a){if("string"!=typeof a)return null;let b=a.trim();return b?b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):null}},31722:(a,b,c)=>{c.d(b,{G_:()=>u,KF:()=>p,KP:()=>l,WP:()=>i,ZS:()=>o,fd:()=>r,iB:()=>m,jp:()=>k,m9:()=>j,rs:()=>q});var d=c(50904);let e="id,company_name,primary_email,user_id,phone,website,country,verified,created_at,notify_quote_messages,notify_quote_winner";function f(a){if("string"!=typeof a)return null;let b=a.trim().toLowerCase();return b.length>0?b:null}function g(a){if("string"!=typeof a)return null;let b=a.trim();return b.length>0?b:null}function h(a){return Array.isArray(a)?a.map(a=>"string"==typeof a?a.trim():"").filter(a=>a.length>0):[]}function i(a){let b=(a?.status??"pending").toLowerCase().trim();return b?"approved"===b?"approved":"rejected"===b?"rejected":"unknown"===b?"unknown":"pending":"pending"}function j(a){return"approved"===i(a)}async function k(a,b,c){let h=f(a);if(!h)throw Error("primaryEmail is required");try{let{data:a,error:f}=await d.w9.from("suppliers").select(e).eq("primary_email",h).maybeSingle();if(f&&console.error("getOrCreateSupplierByEmail: lookup failed",{email:h,error:f}),a){if(!a.user_id&&c){let{error:b}=await d.w9.from("suppliers").update({user_id:c}).eq("id",a.id);b?console.error("getOrCreateSupplierByEmail: failed to link user",{email:h,userId:c,error:b}):a.user_id=c}return a}let i={primary_email:h,company_name:g(b)??h.split("@")[0]?.replace(/\W+/g," ")?.trim()??"Supplier",phone:null,website:null,country:null,verified:!1,user_id:c??null},{data:j,error:k}=await d.w9.from("suppliers").insert(i).select(e).single();if(k||!j)throw console.error("getOrCreateSupplierByEmail: insert failed",{email:h,payload:i,error:k}),Error("Unable to create supplier record");return j}catch(a){throw console.error("getOrCreateSupplierByEmail: unexpected error",{email:h,error:a}),a}}async function l(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierProfile: supplier lookup failed",{email:b,error:c}),null;if(!a)return null;let[f,g]=await Promise.all([s(a.id),t(a.id)]),h=i(a);return{supplier:a,capabilities:f,documents:g,approvalStatus:h,approved:"approved"===h}}catch(a){return console.error("loadSupplierProfile: unexpected error",{email:b,error:a}),null}}async function m(a){let b=f(a);if(!b)return null;try{let{data:a,error:c}=await d.w9.from("suppliers").select(e).eq("primary_email",b).maybeSingle();if(c)return console.error("loadSupplierByPrimaryEmail: lookup failed",{email:b,error:c}),null;return a??null}catch(a){return console.error("loadSupplierByPrimaryEmail: unexpected error",{email:b,error:a}),null}}async function n(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("id",a).maybeSingle();if(c)return console.error("loadSupplierById: lookup failed",{supplierId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierById: unexpected error",{supplierId:a,error:b}),null}}async function o(a){let b=await p(a);if(!b)return null;let[c,d]=await Promise.all([s(b.id),t(b.id)]),e=i(b);return{supplier:b,capabilities:c,documents:d,approvalStatus:e,approved:"approved"===e}}async function p(a){if(!a)return null;try{let{data:b,error:c}=await d.w9.from("suppliers").select(e).eq("user_id",a).maybeSingle();if(c)return console.error("loadSupplierByUserId: lookup failed",{userId:a,error:c}),null;return b??null}catch(b){return console.error("loadSupplierByUserId: unexpected error",{userId:a,error:b}),null}}async function q(a,b){let c=f(a.primaryEmail);if(!c)throw Error("primaryEmail is required");let h=a.supplierId&&a.supplierId.length>0?await n(a.supplierId):null,j=!h&&a.userId?await p(a.userId):null,l=h??j??await k(c,a.companyName??void 0,a.userId??null),m={company_name:g(a.companyName)??l.company_name,phone:g(a.phone),website:g(a.website),country:g(a.country),primary_email:c,user_id:a.userId??l.user_id};try{let{data:c,error:f}=await d.w9.from("suppliers").update(m).eq("id",l.id).select(e).maybeSingle();if(f)throw console.error("upsertSupplierProfile: supplier update failed",{supplierId:l.id,error:f}),Error("Unable to update supplier record");let g=(a.capabilities??[]).filter(a=>"string"==typeof a?.process&&a.process.trim().length>0);b?.skipCapabilities||await u(l.id,g);let[h,j]=await Promise.all([s(l.id),t(l.id)]),k=c??l,n=i(k);return{supplier:k,capabilities:h,documents:j,approvalStatus:n,approved:"approved"===n}}catch(a){throw console.error("upsertSupplierProfile: unexpected error",{supplierId:l.id,error:a}),a}}async function r(a,b){if(!a)throw Error("supplierId is required");if(!b?.fileUrl)throw Error("fileUrl is required");let c={supplier_id:a,file_url:b.fileUrl,doc_type:g(b.docType)};try{let{data:b,error:e}=await d.w9.from("supplier_documents").insert(c).select("*").single();if(e)throw console.error("addSupplierDocument: insert failed",{supplierId:a,error:e}),e;return b??null}catch(b){throw console.error("addSupplierDocument: unexpected error",{supplierId:a,error:b}),b}}async function s(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_capabilities").select("*").eq("supplier_id",a).order("created_at",{ascending:!0});if(c)return console.error("listSupplierCapabilities: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierCapabilities: unexpected error",{supplierId:a,error:b}),[]}}async function t(a){if(!a)return[];try{let{data:b,error:c}=await d.w9.from("supplier_documents").select("*").eq("supplier_id",a).order("uploaded_at",{ascending:!1});if(c)return console.error("listSupplierDocuments: query failed",{supplierId:a,error:c}),[];return b??[]}catch(b){return console.error("listSupplierDocuments: unexpected error",{supplierId:a,error:b}),[]}}async function u(a,b){try{let{error:c}=await d.w9.from("supplier_capabilities").delete().eq("supplier_id",a);if(c)throw c;if(0===b.length)return;let e=b.filter(a=>"string"==typeof a.process&&a.process.trim().length>0).map(b=>({supplier_id:a,process:"string"==typeof b.process?b.process.trim():"",materials:h(b.materials),certifications:h(b.certifications),max_part_size:b.maxPartSize??null}));if(0===e.length)return;let{error:f}=await d.w9.from("supplier_capabilities").insert(e);if(f)throw f}catch(b){throw console.error("upsertSupplierCapabilities: unexpected error",{supplierId:a,error:b}),b}}},50904:(a,b,c)=>{c.d(b,{qr:()=>h,w9:()=>i});var d=c(27982);let e=process.env.SUPABASE_URL??"https://qslztdkptpklopyedkfd.supabase.co/",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzbHp0ZGtwdHBrbG9weWVka2ZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTYzMzksImV4cCI6MjA3ODk5MjMzOX0.et6RdF18ioinJKYNNTE0UVA5HvRH1YaXmA2DgRHLPWo",g=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e)throw Error("SUPABASE_URL or NEXT_PUBLIC_SUPABASE_URL is required (check your env vars).");let h=()=>{if(!f)throw Error("NEXT_PUBLIC_SUPABASE_ANON_KEY is required");return(0,d.UU)(e,f,{auth:{persistSession:!1}})},i=(()=>{if(!g)throw Error("SUPABASE_SERVICE_ROLE_KEY is required");return(0,d.UU)(e,g,{auth:{persistSession:!1}})})()},52453:(a,b,c)=>{c(50904),c(26473),c(31722)}};