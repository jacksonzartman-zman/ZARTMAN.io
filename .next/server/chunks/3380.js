"use strict";exports.id=3380,exports.ids=[3380],exports.modules={4546:(a,b,c)=>{c.d(b,{K:()=>f,U:()=>g});var d=c(81518);function e(a,b){if(!a||!b)return!1;let c=new Date(a).getTime(),d=new Date(b).getTime();return!(Number.isNaN(c)||Number.isNaN(d))&&c===d}function f(a){let{quote:b}=a,c=Array.isArray(a.bids)?a.bids:[],d=[],f=q(b.updated_at)??q(b.created_at);return i(d,b),j(d,b),o(d,a.project??null,f),c.forEach((a,b)=>{k(d,a,{title:"Supplier bid submitted",actorLabel:`Supplier ${b+1}`}),e(a.created_at,a.updated_at)||l(d,a,{title:"Supplier bid updated",actorLabel:`Supplier ${b+1}`})}),c.filter(a=>"won"===r(a.status)).forEach(a=>{m(d,a,{title:"Winning supplier selected",actorLabel:"Customer decision"},f)}),p(d)}function g(a){let{quote:b}=a,c=Array.isArray(a.bids)?a.bids:[],d=s(a.supplierId),f=[],g=q(b.updated_at)??q(b.created_at);if(i(f,b),j(f,b),o(f,a.project??null,g),!d)return p(f);let h=c.filter(a=>s(a.supplier_id)===d);return h.forEach(a=>{k(f,a,{title:"You submitted a bid",actorLabel:"Your shop"}),e(a.created_at,a.updated_at)||l(f,a,{title:"You updated your bid",actorLabel:"Your shop"})}),h.filter(a=>"won"===r(a.status)).forEach(a=>{m(f,a,{title:"Your bid was selected as the winner",actorLabel:"Customer decision"},g)}),p(f)}let h={submitted:"Submitted",in_review:"In review",quoted:"Quoted",won:"Won",lost:"Lost",cancelled:"Cancelled"};function i(a,b){let c=q(b.created_at);c&&a.push({id:`rfq-submitted:${b.id}`,kind:"rfq-submitted",at:c,title:"RFQ submitted",description:"Your RFQ was submitted to Zartman.io."})}function j(a,b){let c=function(a){let b=(a??"").trim().toLowerCase();return b?"in_review"===b?"in_review":"quoted"===b?"quoted":"won"===b?"won":"lost"===b?"lost":"cancelled"===b||"canceled"===b?"cancelled":"submitted":null}(b.status);if(!c)return;let d=q(b.updated_at)??q(b.created_at);if(!d)return;let e=h[c]??"Status updated";a.push({id:`status-changed:${b.id}:${c}`,kind:"status-changed",at:d,title:`Status updated to ${e}`,meta:{status:c}})}function k(a,b,c){let d=q(b.created_at);d&&a.push({id:`bid-submitted:${b.id}`,kind:"bid-submitted",at:d,title:c.title,description:t(b),actorLabel:c.actorLabel,meta:n(b)})}function l(a,b,c){let d=q(b.updated_at),e=q(b.created_at);d&&(e&&e===d||a.push({id:`bid-updated:${b.id}`,kind:"bid-updated",at:d,title:c.title,description:t(b),actorLabel:c.actorLabel,meta:n(b)}))}function m(a,b,c,d){let e=q(b.updated_at)??q(b.created_at)??d??null??new Date().toISOString();a.push({id:`winner-selected:${b.id}`,kind:"winner-selected",at:q(e)??new Date().toISOString(),title:c.title,description:t(b),actorLabel:c.actorLabel,meta:n(b)})}function n(a){return{bidId:a.id,supplierId:a.supplier_id,quoteId:a.quote_id}}function o(a,b,c){if(!b)return;let d=q(b.created_at)??c;d&&a.push({id:`project:${b.id}`,kind:"project_created",at:d,title:"Project kickoff created",description:b.po_number?`PO ${b.po_number} recorded.`:"Project details recorded.",actorLabel:"Zartman.io"})}function p(a){return[...a].sort((a,b)=>{let c=Date.parse(a.at),d=Date.parse(b.at);return Number.isNaN(c)||Number.isNaN(d)||c===d?!Number.isNaN(c)&&Number.isNaN(d)?-1:Number.isNaN(c)&&!Number.isNaN(d)?1:a.kind!==b.kind?a.kind.localeCompare(b.kind):a.id.localeCompare(b.id):c-d})}function q(a){if("string"!=typeof a)return null;let b=a.trim();if(!b)return null;let c=Date.parse(b);return Number.isNaN(c)?null:new Date(c).toISOString()}function r(a){let b=(a??"").trim().toLowerCase();return b?"revised"===b?"revised":"withdrawn"===b?"withdrawn":"won"===b?"won":"lost"===b?"lost":"accepted"===b?"won":"submitted":null}function s(a){return"string"==typeof a?a.trim():""}function t(a){var b;let c="number"==typeof(b=a).amount?b.amount:"number"==typeof b.unit_price?b.unit_price:null,e="number"==typeof c?(0,d.v)(c,a.currency??void 0,{maximumFractionDigits:2}):null,f=e&&"—"!==e?e:null,g=function(a){if("number"!=typeof a||Number.isNaN(a))return null;let b=Math.trunc(a);return`${b} ${1===b?"day":"days"}`}(a.lead_time_days);return f&&g?`${f}, ${g}`:f||g||void 0}},15355:(a,b,c)=>{c.d(b,{A:()=>f});var d=c(75338),e=c(81171);function f({title:a,description:b,children:c,action:f,className:g}){return(0,d.jsxs)("section",{className:(0,e.A)("rounded-2xl border border-slate-900/70 bg-slate-950/70 px-6 py-5 shadow-[0_10px_30px_rgba(2,6,23,0.45)]",g),children:[(0,d.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-white heading-tight",children:a}),b?(0,d.jsx)("p",{className:"mt-1 text-sm text-slate-400 heading-snug",children:b}):null]}),f?(0,d.jsx)("div",{className:"flex shrink-0 items-center",children:f}):null]}),c?(0,d.jsx)("div",{className:"mt-4 text-sm text-slate-200",children:c}):null]})}},23010:(a,b,c)=>{c.d(b,{F:()=>h});var d=c(75338),e=c(81171),f=c(40753);let g={customer:"text-emerald-300",supplier:"text-blue-300"};function h({workspace:a,title:b,subtitle:c,label:h,actions:i,headerContent:j,children:k,className:l,bodyClassName:m}){return(0,d.jsxs)("div",{className:(0,e.A)("space-y-8 lg:space-y-10",l),children:[(0,d.jsx)(f.z,{eyebrow:h??("customer"===a?"Customer workspace":"Supplier workspace"),eyebrowClassName:g[a],title:b,description:c,actions:i,children:j}),(0,d.jsx)("div",{className:(0,e.A)("space-y-8",m),children:k})]})}},33968:(a,b,c)=>{c.d(b,{a:()=>g});var d=c(75338),e=c(81171),f=c(39875);function g({currentLabel:a,nextState:b,variant:c="emerald",className:g}){let h="blue"===c?{currentBadge:"border-blue-500/40 bg-blue-500/10 text-blue-100",nextBadge:"border-slate-800 bg-slate-900/60 text-slate-200"}:{currentBadge:"border-emerald-500/40 bg-emerald-500/10 text-emerald-100",nextBadge:"border-slate-800 bg-slate-900/60 text-slate-200"};return(0,d.jsxs)("div",{className:(0,e.A)("rounded-xl border border-slate-900/60 bg-slate-950/40 p-3",g),children:[(0,d.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-wide text-slate-500",children:"Workflow"}),(0,d.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs font-semibold",children:[(0,d.jsxs)("span",{className:(0,e.A)("inline-flex items-center rounded-full px-3 py-1",h.currentBadge),children:["Current: ",a]}),(0,d.jsx)("span",{className:"text-slate-500",children:"→"}),(0,d.jsx)("span",{className:(0,e.A)("inline-flex items-center rounded-full border px-3 py-1",b?h.nextBadge:"border-emerald-500/30 text-emerald-200"),children:b?(0,f.uJ)(b):"Final milestone"})]}),(0,d.jsx)("p",{className:"mt-2 text-[11px] uppercase tracking-wide text-slate-500",children:b?"Up next once the team advances this RFQ.":"This RFQ has reached the end of the workflow."})]})}},39875:(a,b,c)=>{c.d(b,{CA:()=>g,uJ:()=>h});let d=new Map([["in_review","reviewing"],["in review","reviewing"],["review","reviewing"],["matching","supplier_matching"],["supplier match","supplier_matching"],["quoted","quoted"],["pricing","quoted"],["approved","approved"],["greenlit","approved"],["in_production","in_production"],["in production","in_production"],["production","in_production"],["shipped","shipped"],["delivered","delivered"],["submitted","submitted"]]),e=["submitted","reviewing","supplier_matching","quoted","approved","in_production","shipped","delivered"],f=new Set(e);function g(a){let b=function(a){if(!a)return null;let b=a.trim().toLowerCase();return f.has(b)?b:d.get(b)??null}(a);if(!b)return null;let c=e.indexOf(b);return -1===c||c>=e.length-1?null:e[c+1]}function h(a){return a?a.split("_").map(a=>a.length>0?a.charAt(0).toUpperCase()+a.slice(1):a).join(" "):"—"}},67986:(a,b,c)=>{c.d(b,{U:()=>e});var d=c(33358);function e(a,b){let c=(0,d.Ao)(a.status??d._A),e=d.GM[c]??"Unknown",f=[b?.first_name,b?.last_name].filter(a=>"string"==typeof a&&a.trim().length>0).map(a=>(a??"").trim()).join(" ").trim()||("string"==typeof a.customer_name&&a.customer_name.trim().length>0?a.customer_name.trim():"Customer"),g="string"==typeof a.email&&a.email.includes("@")?a.email:null,h=("string"==typeof b?.company&&(b?.company??"").trim().length>0?b?.company:null)||("string"==typeof a.company&&a.company.trim().length>0?a.company:null),i="string"==typeof b?.notes&&b.notes.trim().length>0?b.notes:null,j="number"==typeof a.price?a.price:"string"==typeof a.price?Number(a.price):null,k="number"==typeof j&&Number.isFinite(j)?j:null,l="string"==typeof a.currency&&a.currency.trim().length>0?a.currency.trim().toUpperCase():null;return{status:c,statusLabel:e,customerName:f,customerEmail:g,companyName:h,intakeNotes:i,priceValue:k,currencyValue:l,targetDateValue:"string"==typeof a.target_date&&a.target_date.trim().length>0?a.target_date:null,dfmNotes:"string"==typeof a.dfm_notes&&a.dfm_notes.trim().length>0?a.dfm_notes:null}}},99066:(a,b,c)=>{c.d(b,{y:()=>i});var d=c(12831),e=c(6173),f=c(81320),g=c(25049),h=c(31023);async function i(a,b){try{let c,i=!!b?.safeOnly,j=null;if(i){let{data:b,error:c}=await d.w9.from("quotes_with_uploads").select(g.L.join(",")).eq("id",a).maybeSingle();if(c&&console.error("Portal workspace loader: failed to load quote",c),!b)return{ok:!1,data:null,error:"Quote not found"};let{data:e,error:f}=await d.w9.from("quotes").select("customer_id,dfm_notes,internal_notes").eq("id",a).maybeSingle();f&&console.error("Portal workspace loader: failed to load quote extras",f),j={...b,customer_id:e?.customer_id??null,dfm_notes:e?.dfm_notes??null,internal_notes:e?.internal_notes??null}}else{let{data:b,error:c}=await d.w9.from("quotes_with_uploads").select("*").eq("id",a).maybeSingle();if(c&&console.error("Portal workspace loader: failed to load quote",c),!b)return{ok:!1,data:null,error:"Quote not found"};j=b}let k=null;if(j.upload_id){let{data:a,error:b}=await d.w9.from("uploads").select("first_name,last_name,phone,company,manufacturing_process,quantity,shipping_postal_code,export_restriction,rfq_reason,notes,itar_acknowledged,terms_accepted,file_name,file_path,mime_type").eq("id",j.upload_id).maybeSingle();b?console.error("Portal workspace loader: failed to load upload meta",b):a&&(k=a,c={file_name:a.file_name,file_path:a.file_path,mime_type:a.mime_type??void 0})}let l=i,m=!1,n={includeFilesTable:!i};void 0!==c&&(n.uploadFileOverride=c),n.onFilesError=b=>{let c=(0,h.H)(b);if((0,h.uW)(b))return void console.warn("Portal workspace loader: files schema missing; treating as zero files",{quoteId:a,error:c});l=!0,m=!0,console.error("Portal workspace loader: files query failed",{quoteId:a,error:c})};let o=await (0,e.Q)(j,n),p=await (0,f.xF)(j.id),q=p.ok&&Array.isArray(p.data)?p.data:[],r=p.ok?null:p.error??"message-load-error",s=l||m;return{ok:!0,data:{quote:j,uploadMeta:k,filePreviews:o,messages:q??[],messagesError:r,filesUnavailable:s},error:s?"files-unavailable":r??null}}catch(b){return console.error("Portal workspace loader: unexpected error",{quoteId:a,error:b}),{ok:!1,data:null,error:"Unexpected error loading quote workspace"}}}}};