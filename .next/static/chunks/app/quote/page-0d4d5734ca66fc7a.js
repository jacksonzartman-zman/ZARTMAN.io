(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2699:(e,t,l)=>{"use strict";l.d(t,{default:()=>g});var a=l(5155),n=l(2115);let r=function(){for(var e,t,l=0,a="",n=arguments.length;l<n;l++)(e=arguments[l])&&(t=function e(t){var l,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t)if(Array.isArray(t)){var r=t.length;for(l=0;l<r;l++)t[l]&&(a=e(t[l]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a);return n}(e))&&(a&&(a+=" "),a+=t);return a},s=["stl","step","stp","iges","igs","sldprt","sldasm","pdf","zip"],i=new Set(s),o=s.map(e=>".".concat(e)).join(","),d="STEP, IGES, STL, SolidWorks (SLDPRT / SLDASM), PDF, or zipped assemblies",c=e=>Number((e/1048576).toFixed(1)),u={file:null,fileName:null,name:"",email:"",company:"",notes:""},m="".concat(c(0x1900000)," MB"),p="Unsupported file type. Please upload ".concat(d,"."),f=e=>!Number.isFinite(e)||e<=0?"0 MB":"".concat(c(e)," MB"),x=e=>(e=>{let t=e.toLowerCase().split("."),l=t.length>1?t.pop():"";return i.has(l)})(e.name)?e.size>0x1900000?"File is ".concat(f(e.size),". Limit is ").concat(m,"."):0===e.size?"File is empty. Please choose a different CAD file.":null:p;function g(){var e;let[t,l]=(0,n.useState)(u),[s,i]=(0,n.useState)(!1),[c,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(null),[h,y]=(0,n.useState)(!1),[v,N]=(0,n.useState)(null),[j,S]=(0,n.useState)(!1),[w,P]=(0,n.useState)(null);(0,n.useEffect)(()=>{if("undefined"!=typeof navigator){var e;S(!!(e=navigator.userAgent)&&(!!/(ipad|iphone|ipod)/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)))}},[]);let D=!!(t.file&&t.name&&t.email),C=e=>t=>{let a=t.target.value;l(t=>({...t,[e]:a}))},k=async e=>{var a,n;if(e.preventDefault(),b(null),y(!1),N(null),P("Validating file…"),!t.file){P(null),b("Please select a CAD file to upload.");return}let r=x(t.file);if(r){P(null),b(r);return}if(!t.name||!t.email){P(null),b("Please add at least your name and email.");return}p(!0),P("Uploading file to Supabase…");try{let e,n=new FormData;n.append("file",t.file),n.append("name",t.name),n.append("email",t.email),n.append("company",t.company),n.append("notes",t.notes);let r=await fetch("/api/upload",{method:"POST",body:n});P("Finalizing upload…");let s=await r.text(),i=null;if(s)try{i=JSON.parse(s)}catch(e){i=null}let o=(e=>{if(!e||"object"!=typeof e)return null;if("string"==typeof e.message){let t=e.message.trim();if(t)return t}if("string"==typeof e.error){let t=e.error.trim();if(t)return t}if(e.details&&"object"==typeof e.details&&"message"in e.details&&"string"==typeof e.details.message){let t=e.details.message.trim();if(t)return t}return null})(i),d=(e=i)&&"object"==typeof e&&"success"in e&&"boolean"==typeof e.success?i:null;if(!r.ok||!d){let e=r.status||500,t=null!=o?o:"Upload failed (".concat(e,")"),l=d&&"step"in d?d.step:void 0,a=[t,l?"Step: ".concat(l):null].filter(Boolean).join(" ");throw Error(a)}if(!1===d.success){let e=r.status||500,t=null!=o?o:"Upload failed (".concat(e,")"),l=d.step?"Step: ".concat(d.step):null;throw Error([t,l].filter(Boolean).join(" "))}let c=(null==(a=d.file)?void 0:a.storagePath)&&d.metadataRecorded?"Stored as ".concat(d.file.storagePath,"."):!1===d.metadataRecorded?"Upload succeeded but metadata logging failed. Please check admin logs.":null,u=[null!=o?o:"Upload complete. We’ll review your CAD shortly.",c].filter(Boolean).join(" ");P(null),l(e=>({...e,file:null,fileName:null,notes:""})),y(!0),N(u),b(null)}catch(e){console.error(e),P(null),b(null!=(n=null==e?void 0:e.message)?n:"Upload failed. Please try again."),y(!1),N(null)}finally{p(!1)}};return(0,a.jsxs)("section",{"aria-label":"Upload CAD file",className:"relative flex flex-col rounded-3xl border border-border bg-surface p-6 sm:p-8",children:[(0,a.jsxs)("div",{className:r("flex flex-col items-center justify-center rounded-2xl border-2 border-dashed px-6 py-10 text-center text-sm sm:px-8 sm:py-12",s?"border-accent/80 bg-accent/5":"border-border/60"),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onDrop:e=>{var t;e.preventDefault(),e.stopPropagation(),i(!1);let a=null==(t=e.dataTransfer.files)?void 0:t[0];if(!a)return;let n=x(a);if(n){b(n),P(null),y(!1),N(null),l(e=>({...e,file:null,fileName:null}));return}b(null),y(!1),N(null),P(null),l(e=>({...e,file:a,fileName:a.name}))},children:[(0,a.jsxs)("p",{className:"text-xs text-muted",children:[d,". Max ",m,"."]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"file",className:"inline-flex cursor-pointer items-center justify-center rounded-full border border-border px-4 py-2 text-xs font-medium text-foreground transition hover:border-accent hover:text-accent",children:"Browse from device"}),(0,a.jsx)("p",{className:"text-[11px] text-muted",children:"…or drag & drop into this box"}),(0,a.jsxs)("p",{className:"mt-1 text-[11px] text-muted",children:["Selected:"," ",t.fileName?(0,a.jsxs)("span",{className:"text-foreground",children:[t.fileName,(null==(e=t.file)?void 0:e.size)?" \xb7 ".concat(f(t.file.size)):null]}):"No file selected yet"]})]}),(0,a.jsx)("input",{id:"file",name:"file",type:"file",className:"hidden",onChange:e=>{var t,a;let n=null!=(a=null==(t=e.target.files)?void 0:t[0])?a:null;if(!n)return;let r=x(n);if(r){b(r),P(null),y(!1),N(null),l(e=>({...e,file:null,fileName:null})),e.target.value="";return}b(null),y(!1),N(null),P(null),l(e=>({...e,file:n,fileName:n.name}))},accept:j?void 0:o})]}),(0,a.jsxs)("form",{onSubmit:k,className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{htmlFor:"name",className:"text-xs font-medium text-muted tracking-wide",children:["Your name",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"name",type:"text",required:!0,value:t.name,onChange:C("name"),className:"w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm text-foreground outline-none ring-0 transition focus:border-accent"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("label",{htmlFor:"email",className:"text-xs font-medium text-muted tracking-wide",children:["Email",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{id:"email",type:"email",required:!0,value:t.email,onChange:C("email"),className:"w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm text-foreground outline-none ring-0 transition focus:border-accent"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"company",className:"text-xs font-medium text-muted tracking-wide",children:"Company"}),(0,a.jsx)("input",{id:"company",type:"text",value:t.company,onChange:C("company"),className:"w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm text-foreground outline-none ring-0 transition focus:border-accent"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("label",{htmlFor:"notes",className:"text-xs font-medium text-muted tracking-wide",children:"Process / quantity / timing"}),(0,a.jsx)("textarea",{id:"notes",rows:3,value:t.notes,onChange:C("notes"),placeholder:"CNC, qty 50, target ship date, special material or tolerances...",className:"w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm text-foreground outline-none ring-0 transition focus:border-accent"})]}),(0,a.jsx)("div",{className:"pt-1",children:(0,a.jsx)("button",{type:"submit",disabled:c||!D,className:r("mt-2 w-full rounded-full px-6 py-3 text-sm font-medium text-black shadow-sm transition disabled:cursor-not-allowed disabled:opacity-70",D&&!c?"bg-emerald-500 hover:bg-emerald-400":"bg-emerald-500/40"),children:c?"Uploading...":"Upload file"})}),(0,a.jsxs)("div",{className:"min-h-[1.25rem] pt-1",children:[g&&(0,a.jsxs)("p",{className:"text-xs text-red-400",role:"alert",children:["Error: ",g]}),!g&&w&&(0,a.jsx)("p",{className:"text-xs text-slate-400",role:"status",children:w}),!g&&!w&&h&&v&&(0,a.jsx)("p",{className:"text-xs text-emerald-400",role:"status",children:v})]})]})]})}},7399:(e,t,l)=>{Promise.resolve().then(l.bind(l,2699))}},e=>{e.O(0,[441,255,358],()=>e(e.s=7399)),_N_E=e.O()}]);