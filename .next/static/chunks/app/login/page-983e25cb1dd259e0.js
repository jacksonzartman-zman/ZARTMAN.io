(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1973:(e,t,n)=>{"use strict";n.d(t,{PortalLoginPanel:()=>c});var o=n(5155),l=n(2115),s=n(63),r=n(926);let i=(0,r.createServerReference)("40126b94578d20979cc3d2e8bf3dbe435569351491",r.callServer,void 0,r.findSourceMapURL,"requestMagicLinkForEmail"),a={customer:{title:"Customer workspace",description:"Use your work email and we’ll send you a magic link to your workspace.",accent:"text-emerald-300",cta:"Email me a link"},supplier:{title:"Supplier workspace",description:"Use the email you onboarded with and we’ll send you a magic link.",accent:"text-blue-300",cta:"Send magic link"}};function c(e){let{role:t,fallbackRedirect:n,nextPath:r}=e,[c,d]=(0,l.useState)(""),[u,g]=(0,l.useState)("idle"),[m,p]=(0,l.useState)(null),[h,b]=(0,l.useState)(null),k=(0,s.usePathname)(),f=Object.prototype.hasOwnProperty.call(a,t);f||console.warn("[portal-login] unknown role received, defaulting to customer",{role:t});let x=f?t:"customer",w="string"==typeof r&&r.startsWith("/")?r:null,y=null!=w?w:"string"==typeof k&&k.startsWith("/".concat(x))?k:n,S=!!w&&("/quote"===w||w.startsWith("/quote"));async function N(e){e.preventDefault();let t=c.trim().toLowerCase();if(!t||!t.includes("@")){p("supplier"===x?"Enter a business email that matches your onboarding profile.":"Enter a valid work email."),g("error");return}try{var n,o;g("sending"),p(null);let e=await i({role:x,email:t,nextPath:y});if(!e.success){g("error"),p(null!=(n=e.error)?n:"supplier"===x?"We couldn’t send the link. Check your connection and try again.":"We couldn’t send the link. Try again in a few seconds.");return}g("sent"),b(null!=(o=e.normalizedEmail)?o:t)}catch(e){console.error("Portal login: failed to request magic link",e),p("supplier"===x?"We couldn’t send the link. Check your connection and try again.":"We couldn’t send the link. Try again in a few seconds."),g("error")}}(0,l.useEffect)(()=>{S&&console.log("[login] rendering quote-flow login",{nextPath:w})},[S,w]);let j=a[x],v=S?{...j,title:"Log in to request a quote",description:"Use your work email and we'll send you a magic link to your customer workspace.",cta:"Send magic link"}:j;return(0,o.jsxs)("section",{className:"mx-auto max-w-lg rounded-2xl border border-slate-900 bg-slate-950/50 p-6",children:[(0,o.jsxs)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] ".concat(v.accent),children:[x," portal"]}),(0,o.jsx)("h2",{className:"mt-2 text-xl font-semibold text-white",children:v.title}),(0,o.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:v.description}),(0,o.jsxs)("form",{onSubmit:N,className:"mt-5 space-y-3",children:[(0,o.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Work email"}),(0,o.jsx)("input",{type:"email",value:c,onChange:e=>d(e.target.value),className:"w-full rounded-lg border border-slate-800 bg-black/40 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-white focus:outline-none",placeholder:"you@company.com",required:!0}),(0,o.jsx)("button",{type:"submit",disabled:"sending"===u,className:"w-full rounded-full border border-slate-800 bg-white/90 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-white disabled:opacity-60",children:"sending"===u?"Sending...":v.cta}),"sent"===u?(0,o.jsx)("p",{className:"text-sm text-emerald-200",children:"supplier"===x?(0,o.jsxs)(o.Fragment,{children:["Link sent to"," ",(0,o.jsx)("span",{className:"font-mono text-white",children:null!=h?h:c.trim().toLowerCase()})," ","– check your inbox."]}):"Check your inbox for the magic link."}):null,m?(0,o.jsx)("p",{className:"text-sm text-red-300",role:"alert",children:m}):null,(0,o.jsxs)("p",{className:"text-xs text-slate-500",children:["You’ll land back on ",(0,o.jsx)("span",{className:"font-mono text-slate-300",children:y})," after clicking the link."]})]})]})}},2337:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var o=n(2115),l=n(63);let s=(0,n(3587).createBrowserClient)("https://qslztdkptpklopyedkfd.supabase.co/","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzbHp0ZGtwdHBrbG9weWVka2ZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MTYzMzksImV4cCI6MjA3ODk5MjMzOX0.et6RdF18ioinJKYNNTE0UVA5HvRH1YaXmA2DgRHLPWo");function r(){let e=(0,l.useRouter)();return(0,o.useEffect)(()=>{(async()=>{var t;let n=new URL(window.location.href),o=null!=(t=window.location.hash)?t:"",l=new URLSearchParams(o.replace(/^#/,"")),r=l.get("access_token"),i=l.get("refresh_token"),a=n.searchParams.get("code"),c=!!(r&&i);if(console.log("[login bridge] current URL:",n.toString()),console.log("[login bridge] hash:",o),console.log("[login bridge] access_token present?",!!r),console.log("[login bridge] refresh_token present?",!!i),console.log("[login bridge] code param:",a),!c&&!a)return console.log("[login bridge] no magic-link tokens found, skipping");try{if(c&&r&&i){console.log("[login bridge] calling supabase.auth.setSession");let{error:e}=await s.auth.setSession({access_token:r,refresh_token:i});if(e)return void console.error("[login bridge] setSession failed",e)}else if(a){console.log("[login bridge] calling supabase.auth.exchangeCodeForSession");let{error:e}=await s.auth.exchangeCodeForSession(a);if(e)return void console.error("[login bridge] exchangeCodeForSession failed",e)}console.log("[login bridge] session established on client, cleaning URL and reloading /login"),window.history.replaceState({},"","/login"),e.replace("/login")}catch(e){console.error("[login bridge] failed to process Supabase login URL",e)}})()},[e]),null}},8772:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2619,23)),Promise.resolve().then(n.bind(n,1973)),Promise.resolve().then(n.bind(n,2337))}},e=>{e.O(0,[619,93,441,255,358],()=>e(e.s=8772)),_N_E=e.O()}]);